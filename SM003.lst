     5	     *	CBL XOPTS(COBOL2)
    20	      IDENTIFICATION DIVISION.
    21	      PROGRAM-ID. SM003.
    22
    23	      ENVIRONMENT DIVISION.
    24	      CONFIGURATION SECTION.
    25	      SOURCE-COMPUTER.	  IBM-PC.
    26	      OBJECT-COMPUTER.	  IBM-PC.
    27	      DATA DIVISION.
    28	      WORKING-STORAGE SECTION.
    74        01  WS-CURRENT-MAP  VALUE 'SM03S'         PIC X(7).
    75	      01  WS-TIME				PIC 9(15).
    76	      01  WS-DATE				PIC 9(7).
    77	      01  WS-DATE-X REDEFINES WS-DATE		PIC X(7).
    78	      01  WS-LENGTH				PIC S9(4) COMP.
    79
    80
    81	      01  WS-END				PIC X(15) VALUE
    82            'INVALID ACCESS'.
    83	      77 WS-RETNCODE				PIC S9(8) COMP.
    84
    85	     * PRE-DEFINE DATA DAPAT MGA ITO AY
    86	     * GALING SA COMMAREA FROM PREVIOUS MAP
    87	     *01 DAPAT-COMMAREA.
    88       *   05 TICKETADD                      PIC X(07) VALUE '000006'.
    89       *   05 REQUESTOR                      PIC X(01) VALUE 'Y'.
    90       *   05 USERID                         PIC X(07) VALUE 'ISCB110'.
    91
    92
    93	      01  TICKET.
    94		  05 TICKET-KEY 			PIC X(07).
    95		  05 TICKET-KEY-NUM REDEFINES TICKET-KEY PIC 9(06).
    96		  05 TICKET-Requestor			PIC X(8).
    97		  05 TICKET-Status			PIC X(10).
    98		  05 TICKET-Title			PIC X(25).
    99		  05 TICKET-Description 		PIC X(100).
   100		  05 TICKET-Last-Update 		PIC X(20).
   101		  05 TICKET-Last-Update-by		PIC X(8).
   102		  05 TICKET-Update-Remarks		PIC X(50).
   103
   104	      01  NEW-TICKET.
   105		  05 NEW-TICKET-KEY			PIC X(07).
   106		  05 NEW-TICKET-KEY-NUM REDEFINES NEW-TICKET-KEY PIC 9(07).
   107		  05 NEW-TICKET-Requestor		PIC X(08).
   108		  05 NEW-TICKET-Status			PIC X(10).
   109		  05 NEW-TICKET-Title			PIC X(25).
   110		  05 NEW-TICKET-Description		PIC X(100).
   111		  05 NEW-TICKET-Last-Update		PIC X(20).
   112		  05 NEW-TICKET-Last-Update-by		PIC X(08).
   113		  05 NEW-TICKET-Update-Remarks		PIC X(50).
   114
   115	      01  WS-LOG.
   116		  05 WS-KEYS.
   117		      10 WS-LOG-Ticket-ID		PIC X(06).
   118		      10 WS-LOG-Seq-Number		PIC 9(03).
   119		  05 WS-LOG-Last-Update 		PIC X(20).
   120		  05 WS-LOG-Last-Update-by		PIC X(10).
   121		  05 WS-LOG-Update-Remarks		PIC X(50).
   122
   123	      01  WS-LOG-BACKUP.   124		  05 WS-B-KEYS.
   125		      10 WS-B-LOG-Ticket-ID		PIC X(06).
   126		      10 WS-B-LOG-Seq-Number		PIC 9(03).
   127		  05 WS-B-LOG-Last-Update		PIC X(20).
   128		  05 WS-B-LOG-Last-Update-by		PIC X(10).
   129		  05 WS-B-LOG-Update-Remarks		PIC X(50).
   130
   131	      01  CHECK-HOLDER.
   132		  05 WS-C-TITLE 			PIC X(25).
   133		  05 WS-C-DES				PIC X(100).
   134		  05 WS-C-UPDATE			PIC X(50).
   135
   136	      01  HOLDER				PIC X(50).
   137
   138
   139	      COPY SM03S.
   141	     * SYMBOLIC MAP of SM03S Created by CACXBMS Version 6.0.27
   142	      01  SM003MI.
   143		  02  FILLER				     PIC X(12).
   144		  02  MAPTL				     PIC S9(4) COMP.
   145		  02  MAPTF				     PIC X.
   146		  02  FILLER REDEFINES MAPTF.
   147		      03  MAPTA 			     PIC X.
   148		  02  MAPTI				     PIC X(006).
   149		  02  DATEL				     PIC S9(4) COMP.
   150		  02  DATEF				     PIC X.
   151		  02  FILLER REDEFINES DATEF.
   152		      03  DATEA 			     PIC X.
   153		  02  DATEI				     PIC X(010).
   154		  02  TIMEL				     PIC S9(4) COMP.
   155		  02  TIMEF				     PIC X.
   156		  02  FILLER REDEFINES TIMEF.
   157		      03  TIMEA 			     PIC X.
   158		  02  TIMEI				     PIC X(008).
   159		  02  IDL				     PIC S9(4) COMP.
   160		  02  IDF				     PIC X.
   161		  02  FILLER REDEFINES IDF.
   162		      03  IDA				     PIC X.
   163		  02  IDI				     PIC X(006).
   164		  02  REQL				     PIC S9(4) COMP.
   165		  02  REQF				     PIC X.
   166		  02  FILLER REDEFINES REQF.
   167		      03  REQA				     PIC X.
   168		  02  REQI				     PIC X(007).
   169		  02  TICKETTL				     PIC S9(4) COMP.
   170		  02  TICKETTF				     PIC X.
   171		  02  FILLER REDEFINES TICKETTF.
   172		      03  TICKETTA			     PIC X.
   173		  02  TICKETTI				     PIC X(025).
   174		  02  TICKTD1L				     PIC S9(4) COMP.
   175		  02  TICKTD1F				     PIC X.
   176		  02  FILLER REDEFINES TICKTD1F.
   177		      03  TICKTD1A			     PIC X.
   178		  02  TICKTD1I				     PIC X(040).
   179		  02  TICKTD2L				     PIC S9(4) COMP.
   180		  02  TICKTD2F				     PIC X.
   181		  02  FILLER REDEFINES TICKTD2F.
   182		      03  TICKTD2A			     PIC X.
   183		  02  TICKTD2I				     PIC X(040).
   184		  02  STL				     PIC S9(4) COMP.   185		  02  STF				     PIC X.
   186		  02  FILLER REDEFINES STF.
   187		      03  STA				     PIC X.
   188		  02  STI				     PIC X(020).
   189		  02  STATSL				     PIC S9(4) COMP.
   190		  02  STATSF				     PIC X.
   191		  02  FILLER REDEFINES STATSF.
   192		      03  STATSA			     PIC X.
   193		  02  STATSI				     PIC X(010).
   194		  02  UPBL				     PIC S9(4) COMP.
   195		  02  UPBF				     PIC X.
   196		  02  FILLER REDEFINES UPBF.
   197		      03  UPBA				     PIC X.
   198		  02  UPBI				     PIC X(007).
   199		  02  UPML				     PIC S9(4) COMP.
   200		  02  UPMF				     PIC X.
   201		  02  FILLER REDEFINES UPMF.
   202		      03  UPMA				     PIC X.
   203		  02  UPMI				     PIC X(020).
   204		  02  UPR1L				     PIC S9(4) COMP.
   205		  02  UPR1F				     PIC X.
   206		  02  FILLER REDEFINES UPR1F.
   207		      03  UPR1A 			     PIC X.
   208		  02  UPR1I				     PIC X(025).
   209		  02  UPR2L				     PIC S9(4) COMP.
   210		  02  UPR2F				     PIC X.
   211		  02  FILLER REDEFINES UPR2F.
   212		      03  UPR2A 			     PIC X.
   213		  02  UPR2I				     PIC X(025).
   214		  02  UPDTL				     PIC S9(4) COMP.
   215		  02  UPDTF				     PIC X.
   216		  02  FILLER REDEFINES UPDTF.
   217		      03  UPDTA 			     PIC X.
   218		  02  UPDTI				     PIC X(020).
   219		  02  UPDATEL				     PIC S9(4) COMP.
   220		  02  UPDATEF				     PIC X.
   221		  02  FILLER REDEFINES UPDATEF.
   222		      03  UPDATEA			     PIC X.
   223		  02  UPDATEI				     PIC X(010).
   224		  02  UPTIMEL				     PIC S9(4) COMP.
   225		  02  UPTIMEF				     PIC X.
   226		  02  FILLER REDEFINES UPTIMEF.
   227		      03  UPTIMEA			     PIC X.
   228		  02  UPTIMEI				     PIC X(010).
   229		  02  ERRMSGL				     PIC S9(4) COMP.
   230		  02  ERRMSGF				     PIC X.
   231		  02  FILLER REDEFINES ERRMSGF.
   232		      03  ERRMSGA			     PIC X.
   233		  02  ERRMSGI				     PIC X(058).
   234	      01  SM003MO REDEFINES SM003MI.
   235		  02  FILLER				     PIC X(12).
   236		  02  FILLER				     PIC XX.
   237		  02  FILLER				     PIC X.
   238		  02  MAPTO				     PIC X(006).
   239		  02  FILLER				     PIC XX.
   240		  02  FILLER				     PIC X.
   241		  02  DATEO				     PIC X(010).
   242		  02  FILLER				     PIC XX.
   243		  02  FILLER				     PIC X.
   244		  02  TIMEO				     PIC X(008).   245		  02  FILLER				     PIC XX.
   246		  02  FILLER				     PIC X.
   247		  02  IDO				     PIC X(006).
   248		  02  FILLER				     PIC XX.
   249		  02  FILLER				     PIC X.
   250		  02  REQO				     PIC X(007).
   251		  02  FILLER				     PIC XX.
   252		  02  FILLER				     PIC X.
   253		  02  TICKETTO				     PIC X(025).
   254		  02  FILLER				     PIC XX.
   255		  02  FILLER				     PIC X.
   256		  02  TICKTD1O				     PIC X(040).
   257		  02  FILLER				     PIC XX.
   258		  02  FILLER				     PIC X.
   259		  02  TICKTD2O				     PIC X(040).
   260		  02  FILLER				     PIC XX.
   261		  02  FILLER				     PIC X.
   262		  02  STO				     PIC X(020).
   263		  02  FILLER				     PIC XX.
   264		  02  FILLER				     PIC X.
   265		  02  STATSO				     PIC X(010).
   266		  02  FILLER				     PIC XX.
   267		  02  FILLER				     PIC X.
   268		  02  UPBO				     PIC X(007).
   269		  02  FILLER				     PIC XX.
   270		  02  FILLER				     PIC X.
   271		  02  UPMO				     PIC X(020).
   272		  02  FILLER				     PIC XX.
   273		  02  FILLER				     PIC X.
   274		  02  UPR1O				     PIC X(025).
   275		  02  FILLER				     PIC XX.
   276		  02  FILLER				     PIC X.
   277		  02  UPR2O				     PIC X(025).
   278		  02  FILLER				     PIC XX.
   279		  02  FILLER				     PIC X.
   280		  02  UPDTO				     PIC X(020).
   281		  02  FILLER				     PIC XX.
   282		  02  FILLER				     PIC X.
   283		  02  UPDATEO				     PIC X(010).
   284		  02  FILLER				     PIC XX.
   285		  02  FILLER				     PIC X.
   286		  02  UPTIMEO				     PIC X(010).
   287		  02  FILLER				     PIC XX.
   288		  02  FILLER				     PIC X.
   289		  02  ERRMSGO				     PIC X(058).
   291	      COPY DFHAID.
   293	      01  DFHAID.
   294	     *
   295	     * CA-Realia CICS 6.0 Computer Associates International, Inc.
   296	     *
   297	     * Revision Information
   298	     * ^{File:dfhaid.cob  }
   299	     * ^{Timestamp:Thu May 15 14:02:52 1997}
   300	     * ^{Revision:2.0}
   301	     *
   302	     *This is the AID constants copy file
   303	     *
   304            05  DFHENTER                  PIC X VALUE ''''.
   305	     *					value APOST
   306            05  DFHCLEAR                  PIC X VALUE '_'.   307            05  DFHPA1                    PIC X VALUE '%'.
   308            05  DFHPA2                    PIC X VALUE '>'.
   309            05  DFHPA3                    PIC X VALUE ','.
   310            05  DFHPF1                    PIC X VALUE '1'.
   311            05  DFHPF2                    PIC X VALUE '2'.
   312            05  DFHPF3                    PIC X VALUE '3'.
   313            05  DFHPF4                    PIC X VALUE '4'.
   314            05  DFHPF5                    PIC X VALUE '5'.
   315            05  DFHPF6                    PIC X VALUE '6'.
   316            05  DFHPF7                    PIC X VALUE '7'.
   317            05  DFHPF8                    PIC X VALUE '8'.
   318            05  DFHPF9                    PIC X VALUE '9'.
   319            05  DFHPF10                   PIC X VALUE ':'.
   320            05  DFHPF11                   PIC X VALUE '#'.
   321            05  DFHPF12                   PIC X VALUE '@'.
   322            05  DFHPF13                   PIC X VALUE 'A'.
   323            05  DFHPF14                   PIC X VALUE 'B'.
   324            05  DFHPF15                   PIC X VALUE 'C'.
   325            05  DFHPF16                   PIC X VALUE 'D'.
   326            05  DFHPF17                   PIC X VALUE 'E'.
   327            05  DFHPF18                   PIC X VALUE 'F'.
   328            05  DFHPF19                   PIC X VALUE 'G'.
   329            05  DFHPF20                   PIC X VALUE 'H'.
   330            05  DFHPF21                   PIC X VALUE 'I'.
   331            05  DFHPF22                   PIC X VALUE '›'.
   332       *                                  EBCDIC Cent sign x'4A'
   333       *                                  ASCII  Cent sign x'9B'
   334            05  DFHPF23                   PIC X VALUE '.'.
   335            05  DFHPF24                   PIC X VALUE '<'.
   336            05  DFHOPID                   PIC X VALUE 'W'.
   337            05  DFHMSRE                   PIC X VALUE 'X'.
   338            05  DFHTRIG                   PIC X VALUE '"'.
   339       *                                        value QUOTE  "
   340            05  DFHPEN                    PIC X VALUE '='.
   341            05  DFHCLRP                   PIC X VALUE 'Ý'.
   342       *                                  EBCDIC x'6A'
   343       *                                  ASCII  x'DD'
   344            05  DFHSTRF                   PIC X VALUE 'h'.
   345	     *	  DFHQUIT is a CA-Realia CICS Extension
   346	     *	  It is set by using <Ctrl>+C or <Ctrl>+<Break> Keys
   347            05  DFHQUIT                   PIC X VALUE '!'.
   348		  05  DFHNULL			PIC X VALUE LOW-VALUE.
   350	      COPY DFHBMSCA.
   352	      01  DFHBMSCA.
   353	     *
   354	     * CA-Realia CICS 6.0 Computer Associates International, Inc.
   355	     *
   356	     * Revision Information
   357	     * ^{File:dfhbmsca.cob}
   358	     * ^{Timestamp:Tue Oct 08 15:34:54 1996}
   359	     * ^{Revision:2.0}
   360	     *
   361	     *	Note:This FILE is provided with most values as quoted literals
   362	     *	     so that the file can be used for both ASCII and EBCDIC
   363	     *	     programs
   364	     *
   365	     *	     The only exceptions are some 3270 Data Stream Orders
   366	     *	     They use different Hexadecimal values for ASCII and
   367	     *	     EBCDIC and they cannot be expressed as quoted literals
   368	     *	     as the values are <Line Feed>, <Tab>, <End of File> etc.   369	     *	     characters in ASCII
   370	     *
   371	     *	     They have their values set up to default to the EBCDIC
   372	     *	     values.
   373	     *
   374	     *	     3270 orders are only needed for EXEC CICS SEND and RECEIVE
   375	     *	     and SEND TEXT with imbedded format orders.
   376	     *	     If you use these values in ASCII programs the values
   377	     *	     must be changed.
   378	     *
   379	     *	     An alternative is to use REPLACING to change the values.
   380	     *
   381	     *	  i.e. COPY DFHBMSCA replacing
   382	     *			    ==005== BY ==009==	*> DFHPT
   383	     *			    ==021== BY ==010==	*> DFHNL
   384	     *			    ==040== BY ==021==	*> DFHSA
   385	     *			    ==041== BY ==031==	*> DFHSFE
   386	     *			    ==044== BY ==023==	*> DFHMF
   387	     *			    ==060== BY ==020==	*> DFHRA
   388	     *			    ==063== BY ==026==. *> DFHSUB
   389	     *
   390	     ******************************************************************
   391	     *BMS and Terminal Control - Order & Attributes constants	      *
   392	     ******************************************************************
   393	     *
   394	     *	  Field Attributes
   395	     *
   396            05  DFHBMASB                          PIC X VALUE '8'.
   397            05  DFHBMASF                          PIC X VALUE '1'.
   398            05  DFHBMASK                          PIC X VALUE '0'.
   399            05  DFHBMBRY                          PIC X VALUE 'H'.
   400            05  DFHBMDAR                          PIC X VALUE '<'.
   401            05  DFHBMFSE                          PIC X VALUE 'A'.
   402            05  DFHBMPRF                          PIC X VALUE '/'.
   403            05  DFHBMPRO                          PIC X VALUE '-'.
   404            05  DFHBMUNN                          PIC X VALUE '&'.
   405            05  DFHBMUNP                          PIC X VALUE ' '.
   406            05  DFHUNNUM                          PIC X VALUE 'J'.
   407	     *
   408	     *	  partially supported
   409	     *
   410            05  DFHUNNOD                          PIC X VALUE '('.
   411            05  DFHUNIMD                          PIC X VALUE 'I'.
   412            05  DFHUNINT                          PIC X VALUE 'R'.
   413            05  DFHUNNON                          PIC X VALUE '('.
   414            05  DFHPROTI                          PIC X VALUE 'Y'.
   415            05  DFHPROTN                          PIC X VALUE '%'.
   416	     *
   417	     *	  These values are additions to mainframe constants
   418	     *
   419            05  DFHBMS-ASK-DARK                   PIC X VALUE '@'.
   420            05  DFHBMS-ASK-BRY-FSET               PIC X VALUE '9'.
   421            05  DFHBMS-ASK-DAR-FSET               PIC X VALUE ''''.
   422	     *						      VALUE APOST
   423            05  DFHBMS-PRO-BRY-FSET               PIC X VALUE 'Z'.
   424            05  DFHBMS-PRO-DAR-FSET               PIC X VALUE '_'.
   425            05  DFHBMS-NUM-BRY                    PIC X VALUE 'Q'.
   426            05  DFHBMS-NUM-DAR                    PIC X VALUE '*'.
   427            05  DFHBMS-NUM-DAR-FSET               PIC X VALUE ')'.
   428	     *   429	     *	  Field Flag values
   430		  05  DFHBMEOF-VAL VALUE 128		PIC S9(4) COMP-4.
   431		  05  FILLER REDEFINES DFHBMEOF-VAL.
   432		      10  FILLER			PIC X.
   433		      10  DFHBMEOF			PIC X.
   434       *                                          x'80'.
   435		  05  DFHBMCUR-VAL VALUE 002		PIC S9(4) COMP-4.
   436		  05  FILLER REDEFINES DFHBMCUR-VAL.
   437		      10  FILLER			PIC X.
   438		      10  DFHBMCUR			PIC X.
   439       *                                          x'02'.
   440		  05  DFHBMMEC-VAL VALUE 130		PIC S9(4) COMP-4.
   441		  05  FILLER REDEFINES DFHBMMEC-VAL.
   442		      10  FILLER			PIC X.
   443		      10  DFHBMMEC			PIC X.
   444       *                                          x'82'.
   445       *                                          x'02'.
   446		  05  DFHBMFLG-VAL  VALUE 0		PIC S9(4) COMP-4.
   447		      88  DFHERASE			VALUES 128 130.
   448       *                                          x'80' X'82'
   449		      88  DFHCURSR			VALUES 002 130.
   450       *                                          x'02' X'82'
   451		  05  FILLER REDEFINES DFHBMFLG-VAL.
   452		      10  FILLER			PIC X.
   453		      10  DFHBMFLG			PIC X.
   454
   455		  05  DFHBMDUP-VAL VALUE 028		PIC S9(4) COMP-4.
   456		  05  FILLER REDEFINES DFHBMDUP-VAL.
   457		      10  FILLER			PIC X.
   458		      10  DFHBMDUP			PIC X.
   459       *                                              x'1C'
   460	     *
   461	     ******************************************************************
   462	     *	  supported 327X Extended Attributes
   463	     *
   464	     *	  Extended COLOR Attributes
   465	     *
   466            05  DFHDFCOL                          PIC X VALUE '0'.
   467            05  DFHBLUE                           PIC X VALUE '1'.
   468            05  DFHRED                            PIC X VALUE '2'.
   469            05  DFHPINK                           PIC X VALUE '3'.
   470            05  DFHGREEN                          PIC X VALUE '4'.
   471            05  DFHTURQ                           PIC X VALUE '5'.
   472            05  DFHYELLO                          PIC X VALUE '6'.
   473            05  DFHNEUTR                          PIC X VALUE '7'.
   474	     *
   475	     *	  Extended HILIGHT Attributes
   476	     *
   477            05  DFHDFHI                           PIC X VALUE '0'.
   478            05  DFHBLINK                          PIC X VALUE '1'.
   479            05  DFHREVRS                          PIC X VALUE '2'.
   480            05  DFHUNDLN                          PIC X VALUE '4'.
   481	     *
   482	     ******************************************************************
   483	     *	  supported 327X Data Stream Orders
   484	     *
   485		  05  DFHSBA-VAL VALUE 017		 PIC S9(4) COMP-4.
   486		  05  FILLER REDEFINES DFHSBA-VAL.
   487		      10  FILLER			PIC X.
   488		      10  DFHSBA			PIC X.   489       *                                              x'11'
   490		  05  DFHEUA-VAL VALUE 018		PIC S9(4) COMP-4.
   491		  05  FILLER REDEFINES DFHEUA-VAL.
   492		      10  FILLER			PIC X.
   493		      10  DFHEUA			PIC X.
   494       *                                              x'12'
   495		  05  DFHIC-VAL VALUE 019		PIC S9(4) COMP-4.
   496		  05  FILLER REDEFINES DFHIC-VAL.
   497		      10  FILLER			PIC X.
   498		      10  DFHIC 			PIC X.
   499       *                                              X'13'.
   500		  05  DFHSF-VAL VALUE 029		PIC S9(4) COMP-4.
   501		  05  FILLER REDEFINES DFHSF-VAL.
   502		      10  FILLER			PIC X.
   503		      10  DFHSF 			PIC X.
   504       *                                              X'1D'.
   505		  05  DFHPT-VAL VALUE 005		PIC S9(4) COMP-4.
   506		      88 DFHPT-VAL-EBCDIC		VALUE 5.
   507		      88 DFHPT-VAL-ASCII		VALUE 9.
   508		  05  FILLER REDEFINES DFHPT-VAL.
   509		      10  FILLER			PIC X.
   510		      10  DFHPT 			PIC X.
   511       *                                              EBCDIC X'05'.
   512       *                                              ASCII  X'09'.
   513		  05  DFHRA-VAL VALUE 060		PIC S9(4) COMP-4.
   514		      88 DFHRA-VAL-EBCDIC		VALUE 60.
   515		      88 DFHRA-VAL-ASCII		VALUE 20.
   516		  05  FILLER REDEFINES DFHRA-VAL.
   517		      10  FILLER			PIC X.
   518		      10  DFHRA 			PIC X.
   519       *                                              EBCDIC x'3C'
   520       *                                              ASCII  x'14'
   521		  05  DFHSFE-VAL VALUE 041		PIC S9(4) COMP-4.
   522		      88 DFHSFE-VAL-EBCDIC		VALUE 41.
   523		      88 DFHSFE-VAL-ASCII		VALUE 31.
   524		  05  FILLER REDEFINES DFHSFE-VAL.
   525		      10  FILLER			PIC X.
   526		      10  DFHSFE			PIC X.
   527       *                                              EBCDIC x'29'
   528       *                                              ASCII  x'1F'
   529		  05  DFHMF-VAL VALUE 044		PIC S9(4) COMP-4.
   530		      88 DFHMF-VAL-EBCDIC		VALUE 44.
   531		      88 DFHMF-VAL-ASCII		VALUE 23.
   532		  05  FILLER REDEFINES DFHMF-VAL.
   533		      10  FILLER			PIC X.
   534		      10  DFHMF 			PIC X.
   535       *                                              EBCDIC x'2C'
   536       *                                              ASCII  x'17'
   537	     *
   538	     ******************************************************************
   539	     *	  unsupported 327X Data Stream order codes
   540	     *
   541		  05  DFHSA-VAL VALUE 040		PIC S9(4) COMP-4.
   542		      88 DFHSA-VAL-EBCDIC		VALUE 40.
   543		      88 DFHSA-VAL-ASCII		VALUE 21.
   544		  05  FILLER REDEFINES DFHSA-VAL.
   545		      10  FILLER			PIC X.
   546		      10  DFHSA 			PIC X.
   547       *                                              EBCDIC x'28'
   548       *                                              ASCII  x'15'   549		  05  DFHGE-VAL VALUE 008		PIC S9(4) COMP-4.
   550		  05  FILLER REDEFINES DFHGE-VAL.
   551		      10  FILLER			PIC X.
   552		      10  DFHGE 			PIC X.
   553       *                                              X'08'.
   554	     *
   555	     ******************************************************************
   556	     *	  SFE and MF supported attribute types
   557	     *
   558            05  DFHCOLOR                          PIC X VALUE 'ƒ'.
   559       *                                              EBCDIC x'42'
   560       *                                              ASCII  x'83'
   561            05  DFHHLT                            PIC X VALUE 'Ö'.
   562       *                                              EBCDIC x'41'
   563       *                                              ASCII  x'D6'
   564            05  DFH3270                           PIC X VALUE '{'.
   565	     *
   566	     *	  supported for SEND TEXT command and printer terminal
   567	     *
   568		  05  DFHBMPNL-VAL VALUE 021		PIC S9(4) COMP-4.
   569		      88 DFHBMPNL-VAL-EBCDIC		VALUE 21.
   570		      88 DFHBMPNL-VAL-ASCII		VALUE 10.
   571		  05  FILLER REDEFINES DFHBMPNL-VAL.
   572		      10  FILLER			PIC X.
   573		      10  DFHBMPNL			PIC X.
   574       *                                              EBCDIC X'15'.
   575       *                                              ASCII  X'0A'.
   576	     *
   577	     ******************************************************************
   578	     *	  Printer terminal data stream only
   579	     *
   580		  05  DFHBMPFF-VAL VALUE 012		PIC S9(4) COMP-4.
   581		  05  FILLER REDEFINES DFHBMPFF-VAL.
   582		      10  FILLER			PIC X.
   583		      10  DFHBMPFF			PIC X.
   584       *                                              X'0C'.
   585		  05  DFHBMPCR-VAL VALUE 013		PIC S9(4) COMP-4.
   586		  05  FILLER REDEFINES DFHBMPCR-VAL.
   587		      10  FILLER			PIC X.
   588		      10  DFHBMPCR			PIC X.
   589       *                                              X'0D'.
   590		  05  DFHBMPEM-VAL VALUE 025		PIC S9(4) COMP-4.
   591		  05  FILLER REDEFINES DFHBMPEM-VAL.
   592		      10  FILLER			PIC X.
   593		      10  DFHBMPEM			PIC X.
   594       *                                              X'19'.
   595	     *
   596	     ******************************************************************
   597	     *	  unsupported Miscellaneous attributes and constants
   598	     *
   599		  05  DFHALL				PIC X VALUE LOW-VALUES.
   600            05  DFHBASE                           PIC X VALUE '0'.
   601		  05  DFHBMDET				PIC X VALUE LOW-VALUES.
   602		  05  DFHBMPSOSI-VAL VALUE 3599 	PIC S9(4) COMP-4.
   603		  05  FILLER REDEFINES DFHBMPSOSI-VAL.
   604		      10  DFHBMPSO			PIC X.
   605       *                                              X'0E'.
   606		      10  DFHBMPSI			PIC X.
   607       *                                              X'0F'.
   608		  05  DFHDFT VALUE HIGH-VALUES		PIC X.   609            05  DFHERROR                          PIC X VALUE '¶'.
   610       *                                              EBCDIC X'1A'.
   611       *                                              ASCII  X'B6'.
   612            05  DFHFIL                            PIC X VALUE '4'.
   613            05  DFHMENT                           PIC X VALUE '2'.
   614            05  DFHMET                            PIC X VALUE '3'.
   615            05  DFHMFE                            PIC X VALUE '6'.
   616            05  DFHMFET                           PIC X VALUE '7'.
   617            05  DFHMFT                            PIC X VALUE '5'.
   618            05  DFHMT                             PIC X VALUE '1'.
   619            05  DFHOUTLN                          PIC X VALUE 'B'.
   620            05  DFHPS                             PIC X VALUE '„'.
   621       *                                              EBCDIC x'43'
   622       *                                              ASCII  x'84'
   623            05  DFHVAL                            PIC X VALUE 'A'.
   624	     *
   625		  05  DFHSUB-VAL   VALUE 063		PIC S9(4) COMP-4.
   626		      88 DFHSUB-VAL-EBCDIC		VALUE 63.
   627		      88 DFHSUB-VAL-ASCII		VALUE 26.
   628		  05  FILLER REDEFINES DFHSUB-VAL.
   629		      10  FILLER			PIC X.
   630		      10  DFHSUB			PIC X.
   631       *                                              EBCDIC X'3F'.
   632       *                                              ASCII  X'1A'.
   633	     *
   634		  05  DFHFM-VAL    VALUE 030		PIC S9(4) COMP-4.
   635		  05  FILLER REDEFINES DFHFM-VAL.
   636		      10  FILLER			PIC X.
   637		      10  DFHFM 			PIC X.
   638       *                                              EBCDIC X'1E'.
   639		  05  DFHEO VALUE HIGH-VALUE		PIC X.
   641
   642	      01  WS-COMMAREA.
   643		  05 WS-PGMID				PIC X(06).
   644		  05 WS-STATE				PIC X.
   645		  05 WS-TICKET-PASSED			PIC X(07).
   646		  05 USERID.
   647		     10  USERID7			PIC X(7).
   648		     10  FILLER 			PIC X(1).
   649		  05 USR-TYPE.
   650		     15 USR-REQUESTOR			PIC X.
   651		     15 USR-ADMIN			PIC X.
   652		     15 USR-APPROVER			PIC X.
   653		     15 USR-SERVICE			PIC X.
   654		  05 WS-SM012-STATE			PIC X.
   655		  05 WS-SM012-PGMID			PIC X(06).
   656		  05 WS-TICKET-NUM			PIC X(07).
   657		  05 WS-FLAG				PIC X(01).
   658		  05 ESC-BACKUP.
   659		     10 WS-E-TITLE			PIC X(25).
   660		     10 WS-E-DES			PIC X(100).
   661		     10 WS-E-STATS			PIC X(10).
   662		     10 WS-E-UPDATE			PIC X(50).
   663
   664	      LINKAGE SECTION.
   666	      01  DFHEIBLK.						       R
   667		  05 EIBTIME  PIC S9(7) COMP-3. 			       R
   668		  05 EIBDATE  PIC S9(7) COMP-3. 			       R
   669		  05 EIBTRNID PIC X(4). 				       R
   670		  05 EIBTASKN PIC S9(7) COMP-3. 			       R   671		  05 EIBTRMID PIC X(4). 				       R
   672		  05 DFHEIGDI PIC S9(4) COMP-4. 			       R
   673		  05 EIBCPOSN PIC S9(4) COMP-4. 			       R
   674		  05 EIBCALEN PIC S9(4) COMP-4. 			       R
   675		  05 EIBAID   PIC X.					       R
   676		  05 EIBFN    PIC X(2). 				       R
   677		  05 EIBRCODE PIC X(6). 				       R
   678		  05 EIBDS    PIC X(8). 				       R
   679		  05 EIBREQID PIC X(8). 				       R
   680		  05 EIBRSRCE PIC X(8). 				       R
   681		  05 EIBSYNC  PIC X.					       R
   682		  05 EIBFREE  PIC X.					       R
   683		  05 EIBRECV  PIC X.					       R
   684		  05 EIBSEND  PIC X.					       R
   685		  05 EIBATT   PIC X.					       R
   686		  05 EIBEOC   PIC X.					       R
   687		  05 EIBFMH   PIC X.					       R
   688		  05 EIBCOMPL PIC X.					       R
   689		  05 EIBSIG   PIC X.					       R
   690		  05 EIBCONF  PIC X.					       R
   691		  05 EIBERR   PIC X.					       R
   692		  05 EIBERRCD PIC X(4). 				       R
   693		  05 EIBSYNRB PIC X.					       R
   694		  05 EIBNODAT PIC X.					       R
   695		  05 EIBRESP  PIC S9(8) COMP-4. 			       R
   696		  05 EIBRESP2 PIC S9(8) COMP-4. 			       R
   697		  05 EIBRLDBK PIC X.					       R
   698		  05 EIBCARESERVED PIC X(32).				       R
   700	      01  DFHCOMMAREA.
   701		  05 DF-PGMID				PIC X(06).
   702		  05 DF-STATE				PIC X.
   703		  05 DF-TICKET-PASSED			PIC X(07).
   704		  05 DF-USERID.
   705		     10  DF-USERID7			PIC X(7).
   706		     10  FILLER 			PIC X(1).
   707		  05 DF-USR-TYPE.
   708		    15 DF-USR-REQUESTOR 		PIC X.
   709		    15 DF-USR-ADMIN			PIC X.
   710		    15 DF-USR-APPROVER			PIC X.
   711		    15 DF-USR-SERVICE			PIC X.
   712		  05 DF-SM012-STATE			PIC X.
   713		  05 DF-SM012-PGMID			PIC X(06).
   714		  05 DF-TICKET-NUM			PIC X(07).
   715		  05 DF-FLAG				PIC X(01).
   716		  05 DF-ESC-BACKUP.
   717		    10 DF-E-TITLE			PIC X(25).
   718		    10 DF-E-DES 			PIC X(100).
   719		    10 DF-E-STATS			PIC X(10).
   720		    10 DF-E-UPDATE			PIC X(50).
   721
   722	      PROCEDURE DIVISION					       R
   724		  USING DFHEIBLK DFHCOMMAREA.				       R
   749	      100-MAIN.
   751		  EXEC CICS IGNORE CONDITION
   752			    ERROR
   753		  END-EXEC
   768
   769		  MOVE DFHCOMMAREA  TO WS-COMMAREA
   770
   771            IF WS-STATE  = 'A' OR   772                WS-STATE   = 'B' OR
   773                WS-STATE   = 'C' OR
   774		      WS-STATE	 =  SPACE
   775		     CONTINUE
   776		  ELSE
   777		     MOVE SPACE TO WS-STATE
   778		  END-IF
   779
   780		  IF WS-TICKET-PASSED  NOT = SPACE AND WS-STATE = SPACE
   781               MOVE 'A' TO WS-STATE
   782		     MOVE WS-TICKET-PASSED  TO WS-TICKET-NUM
   783		  END-IF
   784
   785            IF WS-PGMID = 'SM000' OR WS-PGMID = 'SM001' OR
   786               WS-PGMID = 'SM012'
   787		     PERFORM 4000-RMAP
   788		     IF IDI NOT = NULL
   789		       MOVE IDI TO WS-TICKET-NUM
   790		     END-IF
   791		     PERFORM 2000-CHECK-AID
   792
   793		     EVALUATE TRUE
   794		       WHEN WS-STATE = SPACE
   795			 MOVE DFHBMUNP TO IDA
   796			 MOVE -1 TO IDL
   797			 MOVE DFHBMPRO TO TICKETTA
   798			 MOVE DFHBMPRO TO TICKTD1A
   799			 MOVE DFHBMPRO TO TICKTD2A
   800
   801                 WHEN WS-STATE = 'A'
   802			 PERFORM 3000-READ-RECORD
   803
   804                 WHEN WS-STATE = 'B'
   805			 MOVE -1 TO TICKETTL
   806
   807                 WHEN WS-STATE = 'C'
   808			PERFORM 3200-READ-ONLY
   809			PERFORM 2110-STATEA-FLAGY
   810			MOVE DFHBMPRO TO IDA
   811			MOVE DFHBMPRO TO TICKETTA
   812			MOVE DFHBMPRO TO TICKTD1A
   813			MOVE DFHBMPRO TO TICKTD2A
   814			MOVE DFHBMPRO TO REQA
   815			MOVE DFHBMPRO TO STATSA
   816			MOVE DFHBMPRO TO UPBA
   817			MOVE DFHBMPRO TO UPR1A
   818			MOVE DFHBMPRO TO UPR2A
   819			MOVE DFHBMPRO TO UPDATEA
   820			MOVE DFHBMPRO TO UPTIMEA
   821			MOVE -1 TO IDL
   822
   823		     END-EVALUATE
   824
   825		     PERFORM 2100-CHECK-AID-MSG
   826		     PERFORM 1000-NEW-MAP
   827		  ELSE
   828		     PERFORM 110-INVALID
   829		  END-IF.
   830	      100-EXIT. EXIT.
   831   832	      110-INVALID.
   834		  EXEC CICS SEND TEXT
   835		     FROM (WS-END)
   836		     LENGTH (+15)
   837		     ERASE
   838		  END-EXEC
   869		  EXEC CICS RETURN
   870		  END-EXEC.
   884	      110-EXIT. EXIT.
   885
   886	      1000-NEW-MAP.
   887            MOVE 'SM003' TO MAPTO
   888		  MOVE EIBDATE TO WS-DATE
   889		  MOVE WS-DATE-X TO DATEO
   891		  EXEC CICS ASKTIME
   892		    ABSTIME    (WS-TIME)
   893		  END-EXEC
   912		  EXEC CICS FORMATTIME
   913		    ABSTIME    (WS-TIME)
   914              DATESEP    ('-')
   915		    MMDDYYYY   (DATEO)
   916		    TIME       (TIMEO)
   917              TIMESEP    (':')
   918		  END-EXEC
   958		  MOVE DFHBMASB TO MAPTA
   959		  MOVE DFHBMASB TO TIMEA
   960		  MOVE DFHBMASB TO DATEA
   961		  MOVE DFHBMASB TO ERRMSGA
   962		  MOVE DFHBMASK TO STA
   963		  MOVE DFHBMASK TO UPMA
   964		  MOVE DFHBMASK TO UPDTA
   965		  MOVE LENGTH OF SM003MO TO WS-LENGTH
   967			      EXEC CICS
   968                                 SEND MAP('SM003M')
   969                                 MAPSET('SM03S')
   970				       FROM(SM003MO)
   971				       LENGTH(WS-LENGTH)
   972		     CURSOR
   973		     ERASE
   974				    END-EXEC
  1020		  EXEC CICS RETURN
  1021               TRANSID('SM03')
  1022		       COMMAREA(WS-COMMAREA)
  1023		     LENGTH(207)
  1024			END-EXEC.
  1055	      1000-EXIT. EXIT.
  1056
  1057	      2000-CHECK-AID.
  1058		  EVALUATE TRUE
  1059		   WHEN EIBAID = DFHPF2
  1060               IF WS-STATE = 'B' AND  WS-FLAG = 'V'
  1061		      PERFORM 3000-READ-RECORD
  1062		      IF WS-E-TITLE = NEW-TICKET-Title AND
  1063			 WS-E-DES = NEW-TICKET-Description AND
  1064			 WS-E-STATS = NEW-TICKET-Status AND
  1065			 WS-E-UPDATE = NEW-TICKET-Update-Remarks
  1066
  1067                   MOVE 'W'  TO WS-FLAG
  1068		      ELSE
  1069                   MOVE 'K' TO WS-FLAG  1070
  1071		      END-IF
  1072
  1073		     END-IF
  1074
  1075		   WHEN EIBAID = DFHPF3
  1076       *      IF WS-STATE = 'C' OR 'A'
  1077		      MOVE LOW-VALUES TO WS-STATE
  1078		       MOVE LOW-VALUES TO WS-TICKET-PASSED
  1079		      EVALUATE WS-PGMID
  1080                  WHEN 'SM000'
  1082			     EXEC CICS XCTL
  1083                                            PROGRAM('SM000')
  1084						  COMMAREA(WS-COMMAREA)
  1085						  LENGTH(133)
  1086			     END-EXEC
  1116                  WHEN 'SM001'
  1118			     EXEC CICS XCTL
  1119                                            PROGRAM('SM001')
  1120						  COMMAREA(WS-COMMAREA)
  1121						  LENGTH(133)
  1122			     END-EXEC
  1152                  WHEN 'SM012'
  1154			      EXEC CICS XCTL
  1155                                            PROGRAM('SM001')
  1156						  COMMAREA(WS-COMMAREA)
  1157						  LENGTH(133)
  1158			     END-EXEC
  1188		      END-EVALUATE
  1189	     *	    END-IF
  1190
  1191		   WHEN EIBAID = DFHPF5
  1192               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1193		       MOVE SPACE TO WS-STATE
  1194		       MOVE NULL TO WS-TICKET-NUM
  1195	     *	       MOVE NULL TO MAP3I
  1196		     END-IF
  1197
  1198		   WHEN EIBAID = DFHENTER
  1199		     IF WS-STATE = SPACE
  1200		       IF WS-TICKET-NUM = NULL
  1201			 CONTINUE
  1202		       ELSE
  1203                   MOVE 'A' TO WS-STATE
  1204		       END-IF
  1205		     END-IF
  1206
  1207               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1208                   MOVE 'N' TO WS-FLAG
  1209		     END-IF
  1210
  1211               IF WS-STATE = 'C' AND WS-FLAG = 'N'
  1212			MOVE SPACE TO WS-STATE
  1213			MOVE NULL TO WS-TICKET-NUM
  1214	     *		MOVE NULL TO MAP3I
  1215		     END-IF
  1216
  1217		   WHEN EIBAID = DFHCLEAR
  1218		     CONTINUE
  1219  1220		   WHEN EIBAID = DFHPF12
  1221		     CONTINUE
  1222
  1223		   WHEN OTHER
  1224		     CONTINUE
  1225
  1226		  END-EVALUATE.
  1227	      2000-EXIT. EXIT.
  1228
  1229	      2100-CHECK-AID-MSG.
  1230		  EVALUATE TRUE
  1231		   WHEN EIBAID = DFHPF2
  1232		     IF WS-STATE = SPACE
  1233                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1234		     END-IF
  1235
  1236               IF WS-STATE = 'A'
  1237		       MOVE -1 TO IDL
  1238		       MOVE DFHBMUNP TO IDA
  1239		       MOVE WS-TICKET-NUM TO IDO
  1240                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1241		     END-IF
  1242
  1243		     EVALUATE TRUE
  1244
  1245               WHEN WS-STATE = 'B' AND WS-FLAG = 'W'
  1246		       MOVE -1 TO TICKETTL
  1247                 MOVE 'NO CHANGES' TO ERRMSGO
  1248                 MOVE 'N' TO WS-FLAG
  1249		       PERFORM 2120-STATEB
  1250
  1251               WHEN WS-STATE = 'B' AND WS-FLAG = 'N'
  1252		       PERFORM 3000-READ-RECORD
  1253		       PERFORM 2120-STATEB
  1254                 MOVE 'PRESS ENTER TO VALIDATE' TO ERRMSGO
  1255
  1256              WHEN WS-STATE = 'B' AND WS-FLAG = 'Y'
  1257		       PERFORM 3000-READ-RECORD
  1258		       PERFORM 2120-STATEB
  1259                 MOVE 'PRESS ENTER TO VALIDATE' TO ERRMSGO
  1260
  1261		     END-EVALUATE
  1262
  1263               IF WS-STATE = 'C' AND WS-FLAG = 'N'
  1264                  MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1265		     END-IF
  1266
  1267               IF WS-STATE = 'B' AND WS-FLAG = 'K'
  1268			PERFORM 3500-CHECK-EDIT
  1269			PERFORM 3100-UPDATE-FILE
  1270			MOVE WS-TICKET-NUM TO WS-LOG-Ticket-ID
  1271			MOVE 0 TO WS-LOG-Seq-Number
  1272			PERFORM 3400-CREATE-LOG
  1273			PERFORM 2110-STATEA-FLAGY
  1274			MOVE DFHBMPRO TO IDA
  1275			MOVE DFHBMPRO TO TICKETTA
  1276			MOVE DFHBMPRO TO TICKTD1A
  1277			MOVE DFHBMPRO TO TICKTD2A
  1278			MOVE DFHBMPRO TO REQA
  1279			MOVE DFHBMPRO TO STATSA  1280			MOVE DFHBMPRO TO UPBA
  1281			MOVE DFHBMPRO TO UPR1A
  1282			MOVE DFHBMPRO TO UPR2A
  1283			MOVE DFHBMPRO TO UPDATEA
  1284			MOVE DFHBMPRO TO UPTIMEA
  1285
  1286              MOVE 'TICKET UPDATED, PRESS ENTER TO UPDATE ANOTHER TICKET'
  1287		      TO ERRMSGO
  1288                  MOVE 'N' TO WS-FLAG
  1289                  MOVE 'C' TO WS-STATE
  1290
  1291		     END-IF
  1292
  1293		   WHEN EIBAID = DFHPF5
  1294		     IF WS-STATE = SPACE
  1295                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1296		     END-IF
  1297
  1298               IF WS-STATE = SPACE AND WS-FLAG = 'Y'
  1299                 MOVE 'UPDATE ABORTED' TO ERRMSGO
  1300		       MOVE NULL TO WS-FLAG
  1301		     END-IF
  1302
  1303               IF WS-STATE = 'A'
  1304		       MOVE -1 TO IDL
  1305		       MOVE DFHBMUNP TO IDA
  1306		       MOVE WS-TICKET-NUM TO IDO
  1307                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1308		     END-IF
  1309
  1310               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1311		       PERFORM 3000-READ-RECORD
  1312		       PERFORM 2110-STATEA-FLAGY
  1313                 MOVE 'UPDATE ABORTED' TO ERRMSGO
  1314                 MOVE 'Y' TO WS-FLAG
  1315		       MOVE DFHBMPRO TO IDA
  1316		     END-IF
  1317
  1318               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1319		       PERFORM 3000-READ-RECORD
  1320		       PERFORM 2110-STATEA-FLAGY
  1321                 MOVE 'N' TO WS-FLAG
  1322                 MOVE 'UPDATE ABORTED' TO ERRMSGO
  1323		       MOVE DFHBMPRO TO IDA
  1324		     END-IF
  1325
  1326               IF WS-STATE = 'C' AND WS-FLAG = 'N'
  1327                  MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1328		     END-IF
  1329
  1330		   WHEN EIBAID = DFHENTER
  1331		     IF WS-STATE = SPACE AND WS-TICKET-NUM = NULL
  1332                 MOVE 'ENTER TICKET NUMBER AND PRESS ENTER' TO ERRMSGO
  1333		     END-IF
  1334
  1335               IF WS-STATE = 'A' AND WS-FLAG = 'N'
  1336		       MOVE -1 TO IDL
  1337		       MOVE DFHBMUNP TO IDA
  1338		       MOVE WS-TICKET-NUM TO IDO
  1339                 MOVE 'TICKET NUMBER DOES NOT EXIST' TO ERRMSGO  1340		     END-IF
  1341
  1342               IF WS-STATE = 'A' AND WS-FLAG = 'S'
  1343		       MOVE -1 TO IDL
  1344		       MOVE DFHBMUNP TO IDA
  1345		       MOVE WS-TICKET-NUM TO IDO
  1346                 MOVE 'INVALID TICKET STATUS' TO ERRMSGO
  1347		     END-IF
  1348
  1349               IF WS-STATE = 'A' AND WS-FLAG = 'R'
  1350		       MOVE -1 TO IDL
  1351		       MOVE DFHBMUNP TO IDA
  1352		       MOVE WS-TICKET-NUM TO IDO
  1353                 MOVE 'INVALID ACCESS TO THE TICKET' TO ERRMSGO
  1354		     END-IF
  1355
  1356               IF WS-STATE = 'A' AND WS-FLAG = 'Y'
  1357		       PERFORM 2110-STATEA-FLAGY
  1358                 MOVE 'B' TO WS-STATE
  1359		       MOVE DFHBMPRO TO IDA
  1360		       MOVE -1 TO TICKETTL
  1361                 MOVE 'ENTER UPDATES' TO ERRMSGO
  1362		     END-IF
  1363
  1364               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1365		       PERFORM 3000-READ-RECORD
  1366		       PERFORM 2120-STATEB
  1367                 MOVE 'PRESS PF2 TO UPDATE TICKET' TO ERRMSGO
  1368		     END-IF
  1369
  1370               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1371		       EVALUATE TRUE
  1372			 WHEN TICKETTI = SPACE
  1373			   MOVE -1 TO TICKETTL
  1374                     MOVE 'TICKET TITLE IS REQUIRED' TO ERRMSGO
  1375			 WHEN TICKTD1I = SPACE
  1376			   MOVE -1 TO TICKTD1L
  1377                     MOVE 'DESCRIPTION IS REQUIRED' TO ERRMSGO
  1378                   WHEN STATSI  NOT = 'ONGOING' AND 'COMPLETED'
  1379			   MOVE -1 TO STATSL
  1380                     MOVE 'STATUS IS NOT VALID' TO ERRMSGO
  1381			 WHEN UPR1I = SPACE
  1382			   MOVE -1 TO UPR1L
  1383                     MOVE 'UPDATE REMARKS IS REQUIRED' TO ERRMSGO
  1384			 WHEN OTHER
  1385                     MOVE 'PRESS PF2 TO UPDATE TICKET' TO ERRMSGO
  1386                     MOVE 'V' TO WS-FLAG
  1387		       END-EVALUATE
  1388		       MOVE TICKETTI TO WS-E-TITLE
  1389		       MOVE TICKTD1I TO WS-E-DES(1:50)
  1390		       MOVE TICKTD2I TO WS-E-DES(51:50)
  1391		       MOVE STATSI TO WS-E-STATS
  1392		       MOVE UPR1I TO WS-E-UPDATE(1:25)
  1393		       MOVE UPR2I TO WS-E-UPDATE(26:25)
  1394		       PERFORM 3000-READ-RECORD
  1395		       PERFORM 2120-STATEB
  1396		     END-IF
  1397
  1398		   WHEN EIBAID = DFHCLEAR
  1399               IF WS-STATE = 'A'  1400		       MOVE -1 TO IDL
  1401		       MOVE DFHBMUNP TO IDA
  1402		       MOVE WS-TICKET-NUM TO IDO
  1403		     END-IF
  1404
  1405               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1406		       PERFORM 3000-READ-RECORD
  1407		       PERFORM 2110-STATEA-FLAGY
  1408		       MOVE DFHBMPRO TO IDA
  1409		     END-IF
  1410
  1411               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1412		       PERFORM 3000-READ-RECORD
  1413		       PERFORM 2110-STATEA-FLAGY
  1414		       MOVE DFHBMPRO TO IDA
  1415		     END-IF
  1416
  1417               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1418		       PERFORM 3000-READ-RECORD
  1419		       PERFORM 2120-STATEB
  1420		       MOVE WS-E-TITLE TO TICKETTO
  1421		       MOVE WS-E-DES(1:50) TO TICKTD1O
  1422		       MOVE WS-E-DES(51:50) TO TICKTD2O
  1423		       MOVE WS-E-STATS TO STATSO
  1424		       MOVE WS-E-UPDATE(1:25) TO UPR1O
  1425		       MOVE WS-E-UPDATE(26:25) TO UPR2O
  1426		     END-IF
  1427
  1428               MOVE 'INVALID PFKEY PRESSED' TO ERRMSGO
  1429
  1430		   WHEN EIBAID = DFHPF12
  1431                  MOVE 'SM003' TO WS-SM012-PGMID
  1432			MOVE LOW-VALUES TO WS-SM012-STATE
  1434			EXEC CICS XCTL
  1435                       PROGRAM('SM012')
  1436			     COMMAREA(WS-COMMAREA)
  1437			END-EXEC
  1461
  1462		   WHEN OTHER
  1463               IF WS-STATE = 'A'
  1464		       MOVE -1 TO IDL
  1465		       MOVE DFHBMUNP TO IDA
  1466		       MOVE WS-TICKET-NUM TO IDO
  1467		     END-IF
  1468
  1469               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1470		       PERFORM 3000-READ-RECORD
  1471		       PERFORM 2110-STATEA-FLAGY
  1472		       MOVE DFHBMPRO TO IDA
  1473		     END-IF
  1474
  1475               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1476		       PERFORM 3000-READ-RECORD
  1477		       PERFORM 2110-STATEA-FLAGY
  1478		       MOVE DFHBMPRO TO IDA
  1479		     END-IF
  1480
  1481               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1482		       PERFORM 3000-READ-RECORD
  1483		       PERFORM 2120-STATEB  1484		       MOVE WS-E-TITLE TO TICKETTO
  1485		       MOVE WS-E-DES(1:50) TO TICKTD1O
  1486		       MOVE WS-E-DES(51:50) TO TICKTD2O
  1487		       MOVE WS-E-STATS TO STATSO
  1488		       MOVE WS-E-UPDATE(1:25) TO UPR1O
  1489		       MOVE WS-E-UPDATE(26:25) TO UPR2O
  1490		     END-IF
  1491
  1492
  1493               MOVE 'INVALID PFKEY PRESSED' TO ERRMSGO
  1494
  1495		  END-EVALUATE.
  1496	      2100-EXIT. EXIT.
  1497
  1498	      2110-STATEA-FLAGY.
  1499		   MOVE NEW-TICKET-KEY TO IDO
  1500		   MOVE NEW-TICKET-Title TO TICKETTO
  1501		   MOVE NEW-TICKET-Description(1:50) TO TICKTD1O
  1502		   MOVE NEW-TICKET-Description(51:50) TO TICKTD2O
  1503		   MOVE NEW-TICKET-Requestor TO REQO
  1504		   MOVE NEW-TICKET-Status  TO STATSO
  1505		   MOVE NEW-TICKET-Last-Update-by TO UPBO
  1506		   MOVE NEW-TICKET-Update-Remarks(1:25) TO UPR1O
  1507		   MOVE NEW-TICKET-Update-Remarks(26:25) TO UPR2O
  1508		   MOVE NEW-TICKET-Last-Update(1:10) TO UPDATEO
  1509		   MOVE NEW-TICKET-Last-Update(12:09) TO  UPTIMEO.
  1510	      2110-EXIT. EXIT.
  1511
  1512	      2120-STATEB.
  1513		   MOVE NEW-TICKET-KEY TO IDO
  1514		   MOVE NEW-TICKET-Requestor TO REQO
  1515		   MOVE NEW-TICKET-Last-Update-by TO UPBO
  1516		   MOVE NEW-TICKET-Last-Update(1:10) TO UPDATEO
  1517		   MOVE NEW-TICKET-Last-Update(12:09) TO  UPTIMEO
  1518		   MOVE DFHBMPRO TO IDA.
  1519	      2120-EXIT. EXIT.
  1520
  1521
  1522
  1523	      3000-READ-RECORD.
  1525		  EXEC CICS STARTBR
  1526                 FILE('STF001C')
  1527		       RIDFLD (WS-TICKET-NUM)
  1528		       GTEQ
  1529		  END-EXEC
  1556		  IF EIBRESP = +0
  1558		   EXEC CICS
  1559                  READ FILE('STF001C')
  1560			INTO (NEW-TICKET)
  1561			RIDFLD (WS-TICKET-NUM)
  1562			EQUAL
  1563			UPDATE
  1564		   END-EXEC
  1599             IF NEW-TICKET-Status = 'APPROVED' OR 'ONGOING'
  1600                 IF WS-STATE = 'A'
  1601	     ****I FFIX PA YUN REQUESTOR GALING SA COMMAREA
  1602	     ***************REQUESTOR USER
  1603                   IF USR-REQUESTOR = 'Y'
  1604			   IF USERID = NEW-TICKET-Requestor
  1605                       MOVE 'Y' TO WS-FLAG  1606			   ELSE
  1607                       MOVE 'R' TO WS-FLAG
  1608			   END-IF
  1609			 END-IF
  1610	     ***************SERVICE PROVIDER USER
  1611                   IF USR-SERVICE = 'Y'
  1612                     MOVE 'Y' TO WS-FLAG
  1613			 END-IF
  1614		       END-IF
  1615		   ELSE
  1616               MOVE 'S' TO WS-FLAG
  1617		   END-IF
  1618		  ELSE
  1619             MOVE 'N' TO WS-FLAG
  1620		  END-IF.
  1621	      3000-EXIT. EXIT.
  1622
  1623	      3100-UPDATE-FILE.
  1624		  MOVE WS-E-TITLE TO NEW-TICKET-Title
  1625		  MOVE WS-E-DES TO NEW-TICKET-Description
  1626		  MOVE WS-E-STATS TO NEW-TICKET-Status
  1627		  MOVE WS-E-UPDATE TO NEW-TICKET-Update-Remarks
  1629		  EXEC CICS ASKTIME
  1630		   ABSTIME    (WS-TIME)
  1631		  END-EXEC
  1650		  EXEC CICS FORMATTIME
  1651		    ABSTIME    (WS-TIME)
  1652              DATESEP    ('/')
  1653		    MMDDYYYY   (DATEO)
  1654		    TIME       (TIMEO)
  1655              TIMESEP    (':')
  1656		  END-EXEC
  1696		  MOVE DATEO	TO NEW-TICKET-Last-Update(1:10)
  1697		  MOVE TIMEO	TO NEW-TICKET-Last-Update(12:09)
  1698		  MOVE USERID	TO NEW-TICKET-Last-Update-by
  1700		  EXEC CICS
  1701              REWRITE FILE ('STF001C')
  1702		    FROM (NEW-TICKET)
  1703		    RESP(WS-RETNCODE)
  1704		  END-EXEC.
  1735
  1736	      3100-EXIT. EXIT.
  1737
  1738	      3200-READ-ONLY.
  1740		  EXEC CICS STARTBR
  1741               FILE('STF001C')
  1742		     RIDFLD (WS-TICKET-NUM)
  1743		     GTEQ
  1744		  END-EXEC
  1771		  IF EIBRESP = +0
  1773		   EXEC CICS
  1774               READ FILE('STF001C')
  1775		     INTO (NEW-TICKET)
  1776		     RIDFLD (WS-TICKET-NUM)
  1777		     EQUAL
  1778		     UPDATE
  1779		   END-EXEC.
  1815	      3200-EXIT. EXIT.
  1816
  1817	      3300-READ-LOG.  1818
  1820		  EXEC CICS STARTBR
  1821               FILE('STF002E')
  1822		     RIDFLD (WS-KEYS)
  1823		     GTEQ
  1824		  END-EXEC
  1851
  1852		  MOVE WS-LOG TO WS-LOG-BACKUP
  1853
  1854		  PERFORM UNTIL WS-LOG-Ticket-ID NOT = WS-B-LOG-Ticket-ID
  1856		    EXEC CICS READ
  1857                FILE('STF002E')
  1858		      INTO(WS-LOG)
  1859		      RIDFLD(WS-KEYS)
  1860		      GTEQ
  1861		    END-EXEC
  1893		    IF WS-LOG-Ticket-ID  = WS-B-LOG-Ticket-ID
  1894		      MOVE WS-LOG TO WS-LOG-BACKUP
  1895		      ADD 1 TO WS-LOG-Seq-Number
  1896		    END-IF
  1897
  1898		  END-PERFORM
  1899
  1901		  EXEC CICS ENDBR
  1902              FILE('STF002E')
  1903		  END-EXEC.
  1923
  1924	      3300-EXIT. EXIT.
  1925
  1926	      3400-CREATE-LOG.
  1927		  PERFORM 3300-READ-LOG
  1928		  MOVE WS-LOG-BACKUP TO WS-LOG
  1929		  ADD 1 TO WS-LOG-Seq-Number
  1930	     **********ID GALING SA COMMAREA
  1931		  MOVE USERID TO WS-LOG-Last-Update-by
  1932		  MOVE NEW-TICKET-Last-Update-by  TO WS-LOG-Last-Update-by
  1933		  MOVE HOLDER TO WS-LOG-Update-Remarks
  1935		  EXEC CICS
  1936                 WRITE FILE('STF002E')
  1937		       FROM (WS-LOG)
  1938		       RIDFLD (WS-KEYS)
  1939		       RESP(WS-RETNCODE)
  1940		  END-EXEC
  1975
  1976		  ADD 1 TO WS-LOG-Seq-Number
  1977
  1978		  PERFORM 3600-CHECK-NEW
  1979		  MOVE HOLDER TO WS-LOG-Update-Remarks
  1980
  1982		  EXEC CICS
  1983                 WRITE FILE('STF002E')
  1984		       FROM (WS-LOG)
  1985		       RIDFLD (WS-KEYS)
  1986		       RESP(WS-RETNCODE)
  1987		  END-EXEC.
  2023
  2024
  2025	      3400-EXIT. EXIT.
  2026
  2027	      3500-CHECK-EDIT.  2028
  2029		  IF WS-E-TITLE NOT = NEW-TICKET-Title
  2030		    MOVE WS-E-TITLE TO WS-C-TITLE
  2031		  END-IF
  2032
  2033		  IF WS-E-DES NOT = NEW-TICKET-Description
  2034		      MOVE WS-E-DES TO WS-C-DES
  2035		  END-IF
  2036
  2037		  IF WS-E-UPDATE NOT = NEW-TICKET-Update-Remarks
  2038			MOVE WS-E-UPDATE TO WS-C-UPDATE
  2039		  END-IF.
  2040
  2041            IF NEW-TICKET-Status = 'COMPLETED'
  2042		      EVALUATE TRUE
  2043		      WHEN WS-C-TITLE NOT = NULL AND
  2044			   WS-C-DES NOT = NULL AND
  2045			   WS-C-UPDATE NOT = NULL
  2046                     MOVE 'COMPLETED. TITLE/DESCRIPTION/REMARKS UPDATED'
  2047			     TO HOLDER
  2048
  2049		      WHEN WS-C-TITLE NOT = NULL AND
  2050			   WS-C-DES   NOT = NULL AND
  2051			   WS-C-UPDATE	  = NULL
  2052                     MOVE 'COMPLETED. TITLE/DESCRIPTION UPDATED'
  2053			     TO HOLDER
  2054
  2055		      WHEN WS-C-TITLE NOT = NULL AND
  2056			   WS-C-DES	  = NULL AND
  2057			   WS-C-UPDATE	  = NULL
  2058                     MOVE 'COMPLETED. TITLE UPDATED' TO HOLDER
  2059
  2060		      WHEN WS-C-TITLE	   = NULL AND
  2061			   WS-C-DES    NOT  = NULL AND
  2062			   WS-C-UPDATE NOT = NULL
  2063                     MOVE 'COMPLETED. DESCRIPTION/REMARKS UPDATED'
  2064			    TO HOLDER
  2065
  2066		     WHEN WS-C-TITLE	   = NULL AND
  2067			   WS-C-DES	   = NULL AND
  2068			   WS-C-UPDATE NOT = NULL
  2069                     MOVE 'COMPLETED. REMARKS UPDATED' TO HOLDER
  2070
  2071		     WHEN WS-C-TITLE	   = NULL AND
  2072			   WS-C-DES   NOT  = NULL AND
  2073			   WS-C-UPDATE	   = NULL
  2074                     MOVE 'COMPLETED. DESCRIPTION UPDATED' TO HOLDER
  2075
  2076		      WHEN WS-C-TITLE NOT  = NULL AND
  2077			   WS-C-DES	   = NULL AND
  2078			   WS-C-UPDATE NOT = NULL
  2079                     MOVE 'COMPLETED. TITLE/REMARKS UPDATED' TO HOLDER
  2080		      END-EVALUATE
  2081		  ELSE
  2082		      EVALUATE TRUE
  2083		      WHEN WS-C-TITLE NOT = NULL AND
  2084			   WS-C-DES NOT = NULL AND
  2085			   WS-C-UPDATE NOT = NULL
  2086                     MOVE 'TITLE/DESCRIPTION/REMARKS UPDATED' TO HOLDER
  2087  2088		      WHEN WS-C-TITLE NOT = NULL AND
  2089			   WS-C-DES   NOT = NULL AND
  2090			   WS-C-UPDATE	  = NULL
  2091                     MOVE 'TITLE/DESCRIPTION UPDATED' TO HOLDER
  2092
  2093		      WHEN WS-C-TITLE NOT = NULL AND
  2094			   WS-C-DES	  = NULL AND
  2095			   WS-C-UPDATE	  = NULL
  2096                     MOVE 'TITLE UPDATED' TO HOLDER
  2097
  2098		      WHEN WS-C-TITLE	   = NULL AND
  2099			   WS-C-DES    NOT  = NULL AND
  2100			   WS-C-UPDATE NOT = NULL
  2101                     MOVE 'DESCRIPTION/REMARKS UPDATED' TO HOLDER
  2102
  2103		     WHEN WS-C-TITLE	   = NULL AND
  2104			   WS-C-DES	   = NULL AND
  2105			   WS-C-UPDATE NOT = NULL
  2106                     MOVE 'REMARKS UPDATED' TO HOLDER
  2107
  2108		     WHEN WS-C-TITLE	   = NULL AND
  2109			   WS-C-DES   NOT  = NULL AND
  2110			   WS-C-UPDATE	   = NULL
  2111                     MOVE 'DESCRIPTION UPDATED' TO HOLDER
  2112
  2113		      WHEN WS-C-TITLE NOT  = NULL AND
  2114			   WS-C-DES	   = NULL AND
  2115			   WS-C-UPDATE NOT = NULL
  2116                     MOVE 'TITLE/REMARKS UPDATED' TO HOLDER
  2117
  2118		      END-EVALUATE
  2119		  END-IF.
  2120	      3500-EXIT. EXIT.
  2121
  2122	      3600-CHECK-NEW.
  2123		  EVALUATE TRUE
  2124		      WHEN WS-C-TITLE NOT = NULL AND
  2125			   WS-C-DES NOT = NULL AND
  2126			   WS-C-UPDATE NOT = NULL
  2127                  STRING WS-C-TITLE DELIMITED BY ' '
  2128                    ' ' DELIMITED BY SIZE
  2129                    WS-C-DES DELIMITED BY ' '
  2130                    ' ' DELIMITED BY SIZE
  2131                    WS-C-UPDATE DELIMITED BY ' '
  2132			  INTO HOLDER
  2133			END-STRING
  2134
  2135		      WHEN WS-C-TITLE NOT = NULL AND
  2136			   WS-C-DES   NOT = NULL AND
  2137			   WS-C-UPDATE	  = NULL
  2138                  STRING WS-C-TITLE DELIMITED BY ' '
  2139                    ' ' DELIMITED BY SIZE
  2140                    WS-C-DES DELIMITED BY ' '
  2141			  INTO HOLDER
  2142			END-STRING
  2143
  2144		      WHEN WS-C-TITLE NOT = NULL AND
  2145			   WS-C-DES	  = NULL AND
  2146			   WS-C-UPDATE	  = NULL
  2147                  STRING WS-C-TITLE DELIMITED BY ' '  2148			  INTO HOLDER
  2149			END-STRING
  2150
  2151		      WHEN WS-C-TITLE	   = NULL AND
  2152			   WS-C-DES    NOT  = NULL AND
  2153			   WS-C-UPDATE NOT = NULL
  2154                  STRING WS-C-DES DELIMITED BY ' '
  2155                    ' ' DELIMITED BY SIZE
  2156                    WS-C-UPDATE DELIMITED BY ' '
  2157			  INTO HOLDER
  2158			END-STRING
  2159
  2160		     WHEN WS-C-TITLE	   = NULL AND
  2161			   WS-C-DES	   = NULL AND
  2162			   WS-C-UPDATE NOT = NULL
  2163			STRING
  2164                    WS-C-UPDATE DELIMITED BY ' '
  2165			  INTO HOLDER
  2166			END-STRING
  2167
  2168		     WHEN WS-C-TITLE	   = NULL AND
  2169			   WS-C-DES   NOT  = NULL AND
  2170			   WS-C-UPDATE	   = NULL
  2171		       STRING
  2172                    WS-C-DES DELIMITED BY ' '
  2173			  INTO HOLDER
  2174			END-STRING
  2175
  2176		      WHEN WS-C-TITLE NOT  = NULL AND
  2177			   WS-C-DES	   = NULL AND
  2178			   WS-C-UPDATE NOT = NULL
  2179                  STRING WS-C-TITLE DELIMITED BY ' '
  2180                    ' ' DELIMITED BY SIZE
  2181                    WS-C-UPDATE DELIMITED BY ' '
  2182			  INTO HOLDER
  2183			END-STRING
  2184
  2185		      END-EVALUATE.
  2186
  2187	      3600-EXIT. EXIT.
  2188
  2189	      4000-RMAP.
  2191		  EXEC CICS
  2192                 RECEIVE MAP('SM003M')
  2193                 MAPSET('SM03S')
  2194		       INTO (SM003MI)
  2195		  END-EXEC.
  2229	      4000-EXIT. EXIT.
  2230CA-Realia COBOL Version 6.0.45	 D:\work\CAWB30-HO\SM003.cic	       PAGE   25



			Realia COBOL Compiler Version Information

			      Pass 1	 Version 6.072
			      Pass 1a	 Version 6.015
			      Pass 2	 Version 6.068
			      Pass 2a	 Version 6.020
			      Pass 3	 Version 6.094
			      Pass 4	 Version 6.007
			      Pass 5	 Version 6.022


			Compilation Directives in Effect

COMP-4		  DCHK		    OPT 	      NOCALL
NOSUBCHK	  STRCHK	    NOTRUNC	      NOSMALLCOMP
NODCALL 	  NODIVZERO	    NOEPDCALL	      APOST
EBCDIC		  STATABORT	    NOMOVELINK	      NOBLL4K
ARGCHK		  UPLOW 	    NOVERARG	      MDY
LP:   60	  PP		    FCREATE	      NOIEEE
NOLILIAN	  CURRENCY-SIGN=$   WRITEAFTER	      SOSI
NOCOPY68	  NOFLAG-COM	    NOFLAG-SEG	      NOFLAG-FIPS
DEBUGXREF	  DIALECT-VS2

			Error level limit: W

			Source lines compiled:	    2241
			Compilation time (mm:ss.ss):  0:00.05
			Compilation speed (lines/minute): 89200

			Compilation date (yy/mm/dd): 23/12/06
			     Time of day (hh:mm:ss): 20:42:57