     5	     *	CBL XOPTS(COBOL2)
    20	      IDENTIFICATION DIVISION.
    21	      PROGRAM-ID. SM003.
    22
    23	      ENVIRONMENT DIVISION.
    24	      CONFIGURATION SECTION.
    25	      SOURCE-COMPUTER.	  IBM-PC.
    26	      OBJECT-COMPUTER.	  IBM-PC.
    27	      DATA DIVISION.
    28	      WORKING-STORAGE SECTION.
    74        01  WS-CURRENT-MAP  VALUE 'SM03S'         PIC X(7).
    75	      01  WS-TIME				PIC 9(15).
    76	      01  WS-DATE				PIC 9(7).
    77	      01  WS-DATE-X REDEFINES WS-DATE		PIC X(7).
    78	      01  WS-LENGTH				PIC S9(4) COMP.
    79
    80
    81	      01  WS-END				PIC X(15) VALUE
    82            'INVALID ACCESS'.
    83	      77 WS-RETNCODE				PIC S9(8) COMP.
    84
    85	     * PRE-DEFINE DATA DAPAT MGA ITO AY
    86	     * GALING SA COMMAREA FROM PREVIOUS MAP
    87	     *01 DAPAT-COMMAREA.
    88       *   05 TICKETADD                      PIC X(07) VALUE '000006'.
    89       *   05 REQUESTOR                      PIC X(01) VALUE 'Y'.
    90       *   05 USERID                         PIC X(07) VALUE 'ISCB110'.
    91
    92
    93	      01  TICKET.
    94		  05 TICKET-KEY 			PIC X(07).
    95		  05 TICKET-KEY-NUM REDEFINES TICKET-KEY PIC 9(06).
    96		  05 TICKET-Requestor			PIC X(8).
    97		  05 TICKET-Status			PIC X(10).
    98		  05 TICKET-Title			PIC X(25).
    99		  05 TICKET-Description 		PIC X(100).
   100		  05 TICKET-Last-Update 		PIC X(20).
   101		  05 TICKET-Last-Update-by		PIC X(8).
   102		  05 TICKET-Update-Remarks		PIC X(50).
   103
   104	      01  NEW-TICKET.
   105		  05 NEW-TICKET-KEY			PIC X(07).
   106		  05 NEW-TICKET-KEY-NUM REDEFINES NEW-TICKET-KEY PIC 9(07).
   107		  05 NEW-TICKET-Requestor		PIC X(08).
   108		  05 NEW-TICKET-Status			PIC X(10).
   109		  05 NEW-TICKET-Title			PIC X(25).
   110		  05 NEW-TICKET-Description		PIC X(100).
   111		  05 NEW-TICKET-Last-Update		PIC X(20).
   112		  05 NEW-TICKET-Last-Update-by		PIC X(08).
   113		  05 NEW-TICKET-Update-Remarks		PIC X(50).
   114
   115	      01  WS-LOG.
   116		  05 WS-KEYS.
   117		      10 WS-LOG-Ticket-ID		PIC X(06).
   118		      10 WS-LOG-Seq-Number		PIC 9(03).
   119		  05 WS-LOG-Last-Update 		PIC X(20).
   120		  05 WS-LOG-Last-Update-by		PIC X(10).
   121		  05 WS-LOG-Update-Remarks		PIC X(50).
   122
   123	      01  WS-LOG-BACKUP.   124		  05 WS-B-KEYS.
   125		      10 WS-B-LOG-Ticket-ID		PIC X(06).
   126		      10 WS-B-LOG-Seq-Number		PIC 9(03).
   127		  05 WS-B-LOG-Last-Update		PIC X(20).
   128		  05 WS-B-LOG-Last-Update-by		PIC X(10).
   129		  05 WS-B-LOG-Update-Remarks		PIC X(50).
   130
   131	      01  CHECK-HOLDER.
   132		  05 WS-C-TITLE 			PIC X(25).
   133		  05 WS-C-DES				PIC X(100).
   134		  05 WS-C-UPDATE			PIC X(50).
   135
   136	      01  HOLDER				PIC X(50).
   137
   138
   139	      COPY SM03S.
   141	     * SYMBOLIC MAP of SM03S Created by CACXBMS Version 6.0.27
   142	      01  SM003MI.
   143		  02  FILLER				     PIC X(12).
   144		  02  MAPTL				     PIC S9(4) COMP.
   145		  02  MAPTF				     PIC X.
   146		  02  FILLER REDEFINES MAPTF.
   147		      03  MAPTA 			     PIC X.
   148		  02  MAPTI				     PIC X(006).
   149		  02  DATEL				     PIC S9(4) COMP.
   150		  02  DATEF				     PIC X.
   151		  02  FILLER REDEFINES DATEF.
   152		      03  DATEA 			     PIC X.
   153		  02  DATEI				     PIC X(010).
   154		  02  TIMEL				     PIC S9(4) COMP.
   155		  02  TIMEF				     PIC X.
   156		  02  FILLER REDEFINES TIMEF.
   157		      03  TIMEA 			     PIC X.
   158		  02  TIMEI				     PIC X(008).
   159		  02  IDL				     PIC S9(4) COMP.
   160		  02  IDF				     PIC X.
   161		  02  FILLER REDEFINES IDF.
   162		      03  IDA				     PIC X.
   163		  02  IDI				     PIC X(006).
   164		  02  REQL				     PIC S9(4) COMP.
   165		  02  REQF				     PIC X.
   166		  02  FILLER REDEFINES REQF.
   167		      03  REQA				     PIC X.
   168		  02  REQI				     PIC X(007).
   169		  02  TICKETTL				     PIC S9(4) COMP.
   170		  02  TICKETTF				     PIC X.
   171		  02  FILLER REDEFINES TICKETTF.
   172		      03  TICKETTA			     PIC X.
   173		  02  TICKETTI				     PIC X(025).
   174		  02  TICKTD1L				     PIC S9(4) COMP.
   175		  02  TICKTD1F				     PIC X.
   176		  02  FILLER REDEFINES TICKTD1F.
   177		      03  TICKTD1A			     PIC X.
   178		  02  TICKTD1I				     PIC X(040).
   179		  02  TICKTD2L				     PIC S9(4) COMP.
   180		  02  TICKTD2F				     PIC X.
   181		  02  FILLER REDEFINES TICKTD2F.
   182		      03  TICKTD2A			     PIC X.
   183		  02  TICKTD2I				     PIC X(040).
   184		  02  STL				     PIC S9(4) COMP.   185		  02  STF				     PIC X.
   186		  02  FILLER REDEFINES STF.
   187		      03  STA				     PIC X.
   188		  02  STI				     PIC X(020).
   189		  02  STATSL				     PIC S9(4) COMP.
   190		  02  STATSF				     PIC X.
   191		  02  FILLER REDEFINES STATSF.
   192		      03  STATSA			     PIC X.
   193		  02  STATSI				     PIC X(010).
   194		  02  UPBL				     PIC S9(4) COMP.
   195		  02  UPBF				     PIC X.
   196		  02  FILLER REDEFINES UPBF.
   197		      03  UPBA				     PIC X.
   198		  02  UPBI				     PIC X(007).
   199		  02  UPML				     PIC S9(4) COMP.
   200		  02  UPMF				     PIC X.
   201		  02  FILLER REDEFINES UPMF.
   202		      03  UPMA				     PIC X.
   203		  02  UPMI				     PIC X(020).
   204		  02  UPR1L				     PIC S9(4) COMP.
   205		  02  UPR1F				     PIC X.
   206		  02  FILLER REDEFINES UPR1F.
   207		      03  UPR1A 			     PIC X.
   208		  02  UPR1I				     PIC X(025).
   209		  02  UPR2L				     PIC S9(4) COMP.
   210		  02  UPR2F				     PIC X.
   211		  02  FILLER REDEFINES UPR2F.
   212		      03  UPR2A 			     PIC X.
   213		  02  UPR2I				     PIC X(025).
   214		  02  UPDTL				     PIC S9(4) COMP.
   215		  02  UPDTF				     PIC X.
   216		  02  FILLER REDEFINES UPDTF.
   217		      03  UPDTA 			     PIC X.
   218		  02  UPDTI				     PIC X(020).
   219		  02  UPDATEL				     PIC S9(4) COMP.
   220		  02  UPDATEF				     PIC X.
   221		  02  FILLER REDEFINES UPDATEF.
   222		      03  UPDATEA			     PIC X.
   223		  02  UPDATEI				     PIC X(010).
   224		  02  UPTIMEL				     PIC S9(4) COMP.
   225		  02  UPTIMEF				     PIC X.
   226		  02  FILLER REDEFINES UPTIMEF.
   227		      03  UPTIMEA			     PIC X.
   228		  02  UPTIMEI				     PIC X(010).
   229		  02  ERRMSGL				     PIC S9(4) COMP.
   230		  02  ERRMSGF				     PIC X.
   231		  02  FILLER REDEFINES ERRMSGF.
   232		      03  ERRMSGA			     PIC X.
   233		  02  ERRMSGI				     PIC X(058).
   234	      01  SM003MO REDEFINES SM003MI.
   235		  02  FILLER				     PIC X(12).
   236		  02  FILLER				     PIC XX.
   237		  02  FILLER				     PIC X.
   238		  02  MAPTO				     PIC X(006).
   239		  02  FILLER				     PIC XX.
   240		  02  FILLER				     PIC X.
   241		  02  DATEO				     PIC X(010).
   242		  02  FILLER				     PIC XX.
   243		  02  FILLER				     PIC X.
   244		  02  TIMEO				     PIC X(008).   245		  02  FILLER				     PIC XX.
   246		  02  FILLER				     PIC X.
   247		  02  IDO				     PIC X(006).
   248		  02  FILLER				     PIC XX.
   249		  02  FILLER				     PIC X.
   250		  02  REQO				     PIC X(007).
   251		  02  FILLER				     PIC XX.
   252		  02  FILLER				     PIC X.
   253		  02  TICKETTO				     PIC X(025).
   254		  02  FILLER				     PIC XX.
   255		  02  FILLER				     PIC X.
   256		  02  TICKTD1O				     PIC X(040).
   257		  02  FILLER				     PIC XX.
   258		  02  FILLER				     PIC X.
   259		  02  TICKTD2O				     PIC X(040).
   260		  02  FILLER				     PIC XX.
   261		  02  FILLER				     PIC X.
   262		  02  STO				     PIC X(020).
   263		  02  FILLER				     PIC XX.
   264		  02  FILLER				     PIC X.
   265		  02  STATSO				     PIC X(010).
   266		  02  FILLER				     PIC XX.
   267		  02  FILLER				     PIC X.
   268		  02  UPBO				     PIC X(007).
   269		  02  FILLER				     PIC XX.
   270		  02  FILLER				     PIC X.
   271		  02  UPMO				     PIC X(020).
   272		  02  FILLER				     PIC XX.
   273		  02  FILLER				     PIC X.
   274		  02  UPR1O				     PIC X(025).
   275		  02  FILLER				     PIC XX.
   276		  02  FILLER				     PIC X.
   277		  02  UPR2O				     PIC X(025).
   278		  02  FILLER				     PIC XX.
   279		  02  FILLER				     PIC X.
   280		  02  UPDTO				     PIC X(020).
   281		  02  FILLER				     PIC XX.
   282		  02  FILLER				     PIC X.
   283		  02  UPDATEO				     PIC X(010).
   284		  02  FILLER				     PIC XX.
   285		  02  FILLER				     PIC X.
   286		  02  UPTIMEO				     PIC X(010).
   287		  02  FILLER				     PIC XX.
   288		  02  FILLER				     PIC X.
   289		  02  ERRMSGO				     PIC X(058).
   291	      COPY DFHAID.
   293	      01  DFHAID.
   294	     *
   295	     * CA-Realia CICS 6.0 Computer Associates International, Inc.
   296	     *
   297	     * Revision Information
   298	     * ^{File:dfhaid.cob  }
   299	     * ^{Timestamp:Thu May 15 14:02:52 1997}
   300	     * ^{Revision:2.0}
   301	     *
   302	     *This is the AID constants copy file
   303	     *
   304            05  DFHENTER                  PIC X VALUE ''''.
   305	     *					value APOST
   306            05  DFHCLEAR                  PIC X VALUE '_'.   307            05  DFHPA1                    PIC X VALUE '%'.
   308            05  DFHPA2                    PIC X VALUE '>'.
   309            05  DFHPA3                    PIC X VALUE ','.
   310            05  DFHPF1                    PIC X VALUE '1'.
   311            05  DFHPF2                    PIC X VALUE '2'.
   312            05  DFHPF3                    PIC X VALUE '3'.
   313            05  DFHPF4                    PIC X VALUE '4'.
   314            05  DFHPF5                    PIC X VALUE '5'.
   315            05  DFHPF6                    PIC X VALUE '6'.
   316            05  DFHPF7                    PIC X VALUE '7'.
   317            05  DFHPF8                    PIC X VALUE '8'.
   318            05  DFHPF9                    PIC X VALUE '9'.
   319            05  DFHPF10                   PIC X VALUE ':'.
   320            05  DFHPF11                   PIC X VALUE '#'.
   321            05  DFHPF12                   PIC X VALUE '@'.
   322            05  DFHPF13                   PIC X VALUE 'A'.
   323            05  DFHPF14                   PIC X VALUE 'B'.
   324            05  DFHPF15                   PIC X VALUE 'C'.
   325            05  DFHPF16                   PIC X VALUE 'D'.
   326            05  DFHPF17                   PIC X VALUE 'E'.
   327            05  DFHPF18                   PIC X VALUE 'F'.
   328            05  DFHPF19                   PIC X VALUE 'G'.
   329            05  DFHPF20                   PIC X VALUE 'H'.
   330            05  DFHPF21                   PIC X VALUE 'I'.
   331            05  DFHPF22                   PIC X VALUE '›'.
   332       *                                  EBCDIC Cent sign x'4A'
   333       *                                  ASCII  Cent sign x'9B'
   334            05  DFHPF23                   PIC X VALUE '.'.
   335            05  DFHPF24                   PIC X VALUE '<'.
   336            05  DFHOPID                   PIC X VALUE 'W'.
   337            05  DFHMSRE                   PIC X VALUE 'X'.
   338            05  DFHTRIG                   PIC X VALUE '"'.
   339       *                                        value QUOTE  "
   340            05  DFHPEN                    PIC X VALUE '='.
   341            05  DFHCLRP                   PIC X VALUE 'Ý'.
   342       *                                  EBCDIC x'6A'
   343       *                                  ASCII  x'DD'
   344            05  DFHSTRF                   PIC X VALUE 'h'.
   345	     *	  DFHQUIT is a CA-Realia CICS Extension
   346	     *	  It is set by using <Ctrl>+C or <Ctrl>+<Break> Keys
   347            05  DFHQUIT                   PIC X VALUE '!'.
   348		  05  DFHNULL			PIC X VALUE LOW-VALUE.
   350	      COPY DFHBMSCA.
   352	      01  DFHBMSCA.
   353	     *
   354	     * CA-Realia CICS 6.0 Computer Associates International, Inc.
   355	     *
   356	     * Revision Information
   357	     * ^{File:dfhbmsca.cob}
   358	     * ^{Timestamp:Tue Oct 08 15:34:54 1996}
   359	     * ^{Revision:2.0}
   360	     *
   361	     *	Note:This FILE is provided with most values as quoted literals
   362	     *	     so that the file can be used for both ASCII and EBCDIC
   363	     *	     programs
   364	     *
   365	     *	     The only exceptions are some 3270 Data Stream Orders
   366	     *	     They use different Hexadecimal values for ASCII and
   367	     *	     EBCDIC and they cannot be expressed as quoted literals
   368	     *	     as the values are <Line Feed>, <Tab>, <End of File> etc.   369	     *	     characters in ASCII
   370	     *
   371	     *	     They have their values set up to default to the EBCDIC
   372	     *	     values.
   373	     *
   374	     *	     3270 orders are only needed for EXEC CICS SEND and RECEIVE
   375	     *	     and SEND TEXT with imbedded format orders.
   376	     *	     If you use these values in ASCII programs the values
   377	     *	     must be changed.
   378	     *
   379	     *	     An alternative is to use REPLACING to change the values.
   380	     *
   381	     *	  i.e. COPY DFHBMSCA replacing
   382	     *			    ==005== BY ==009==	*> DFHPT
   383	     *			    ==021== BY ==010==	*> DFHNL
   384	     *			    ==040== BY ==021==	*> DFHSA
   385	     *			    ==041== BY ==031==	*> DFHSFE
   386	     *			    ==044== BY ==023==	*> DFHMF
   387	     *			    ==060== BY ==020==	*> DFHRA
   388	     *			    ==063== BY ==026==. *> DFHSUB
   389	     *
   390	     ******************************************************************
   391	     *BMS and Terminal Control - Order & Attributes constants	      *
   392	     ******************************************************************
   393	     *
   394	     *	  Field Attributes
   395	     *
   396            05  DFHBMASB                          PIC X VALUE '8'.
   397            05  DFHBMASF                          PIC X VALUE '1'.
   398            05  DFHBMASK                          PIC X VALUE '0'.
   399            05  DFHBMBRY                          PIC X VALUE 'H'.
   400            05  DFHBMDAR                          PIC X VALUE '<'.
   401            05  DFHBMFSE                          PIC X VALUE 'A'.
   402            05  DFHBMPRF                          PIC X VALUE '/'.
   403            05  DFHBMPRO                          PIC X VALUE '-'.
   404            05  DFHBMUNN                          PIC X VALUE '&'.
   405            05  DFHBMUNP                          PIC X VALUE ' '.
   406            05  DFHUNNUM                          PIC X VALUE 'J'.
   407	     *
   408	     *	  partially supported
   409	     *
   410            05  DFHUNNOD                          PIC X VALUE '('.
   411            05  DFHUNIMD                          PIC X VALUE 'I'.
   412            05  DFHUNINT                          PIC X VALUE 'R'.
   413            05  DFHUNNON                          PIC X VALUE '('.
   414            05  DFHPROTI                          PIC X VALUE 'Y'.
   415            05  DFHPROTN                          PIC X VALUE '%'.
   416	     *
   417	     *	  These values are additions to mainframe constants
   418	     *
   419            05  DFHBMS-ASK-DARK                   PIC X VALUE '@'.
   420            05  DFHBMS-ASK-BRY-FSET               PIC X VALUE '9'.
   421            05  DFHBMS-ASK-DAR-FSET               PIC X VALUE ''''.
   422	     *						      VALUE APOST
   423            05  DFHBMS-PRO-BRY-FSET               PIC X VALUE 'Z'.
   424            05  DFHBMS-PRO-DAR-FSET               PIC X VALUE '_'.
   425            05  DFHBMS-NUM-BRY                    PIC X VALUE 'Q'.
   426            05  DFHBMS-NUM-DAR                    PIC X VALUE '*'.
   427            05  DFHBMS-NUM-DAR-FSET               PIC X VALUE ')'.
   428	     *   429	     *	  Field Flag values
   430		  05  DFHBMEOF-VAL VALUE 128		PIC S9(4) COMP-4.
   431		  05  FILLER REDEFINES DFHBMEOF-VAL.
   432		      10  FILLER			PIC X.
   433		      10  DFHBMEOF			PIC X.
   434       *                                          x'80'.
   435		  05  DFHBMCUR-VAL VALUE 002		PIC S9(4) COMP-4.
   436		  05  FILLER REDEFINES DFHBMCUR-VAL.
   437		      10  FILLER			PIC X.
   438		      10  DFHBMCUR			PIC X.
   439       *                                          x'02'.
   440		  05  DFHBMMEC-VAL VALUE 130		PIC S9(4) COMP-4.
   441		  05  FILLER REDEFINES DFHBMMEC-VAL.
   442		      10  FILLER			PIC X.
   443		      10  DFHBMMEC			PIC X.
   444       *                                          x'82'.
   445       *                                          x'02'.
   446		  05  DFHBMFLG-VAL  VALUE 0		PIC S9(4) COMP-4.
   447		      88  DFHERASE			VALUES 128 130.
   448       *                                          x'80' X'82'
   449		      88  DFHCURSR			VALUES 002 130.
   450       *                                          x'02' X'82'
   451		  05  FILLER REDEFINES DFHBMFLG-VAL.
   452		      10  FILLER			PIC X.
   453		      10  DFHBMFLG			PIC X.
   454
   455		  05  DFHBMDUP-VAL VALUE 028		PIC S9(4) COMP-4.
   456		  05  FILLER REDEFINES DFHBMDUP-VAL.
   457		      10  FILLER			PIC X.
   458		      10  DFHBMDUP			PIC X.
   459       *                                              x'1C'
   460	     *
   461	     ******************************************************************
   462	     *	  supported 327X Extended Attributes
   463	     *
   464	     *	  Extended COLOR Attributes
   465	     *
   466            05  DFHDFCOL                          PIC X VALUE '0'.
   467            05  DFHBLUE                           PIC X VALUE '1'.
   468            05  DFHRED                            PIC X VALUE '2'.
   469            05  DFHPINK                           PIC X VALUE '3'.
   470            05  DFHGREEN                          PIC X VALUE '4'.
   471            05  DFHTURQ                           PIC X VALUE '5'.
   472            05  DFHYELLO                          PIC X VALUE '6'.
   473            05  DFHNEUTR                          PIC X VALUE '7'.
   474	     *
   475	     *	  Extended HILIGHT Attributes
   476	     *
   477            05  DFHDFHI                           PIC X VALUE '0'.
   478            05  DFHBLINK                          PIC X VALUE '1'.
   479            05  DFHREVRS                          PIC X VALUE '2'.
   480            05  DFHUNDLN                          PIC X VALUE '4'.
   481	     *
   482	     ******************************************************************
   483	     *	  supported 327X Data Stream Orders
   484	     *
   485		  05  DFHSBA-VAL VALUE 017		 PIC S9(4) COMP-4.
   486		  05  FILLER REDEFINES DFHSBA-VAL.
   487		      10  FILLER			PIC X.
   488		      10  DFHSBA			PIC X.   489       *                                              x'11'
   490		  05  DFHEUA-VAL VALUE 018		PIC S9(4) COMP-4.
   491		  05  FILLER REDEFINES DFHEUA-VAL.
   492		      10  FILLER			PIC X.
   493		      10  DFHEUA			PIC X.
   494       *                                              x'12'
   495		  05  DFHIC-VAL VALUE 019		PIC S9(4) COMP-4.
   496		  05  FILLER REDEFINES DFHIC-VAL.
   497		      10  FILLER			PIC X.
   498		      10  DFHIC 			PIC X.
   499       *                                              X'13'.
   500		  05  DFHSF-VAL VALUE 029		PIC S9(4) COMP-4.
   501		  05  FILLER REDEFINES DFHSF-VAL.
   502		      10  FILLER			PIC X.
   503		      10  DFHSF 			PIC X.
   504       *                                              X'1D'.
   505		  05  DFHPT-VAL VALUE 005		PIC S9(4) COMP-4.
   506		      88 DFHPT-VAL-EBCDIC		VALUE 5.
   507		      88 DFHPT-VAL-ASCII		VALUE 9.
   508		  05  FILLER REDEFINES DFHPT-VAL.
   509		      10  FILLER			PIC X.
   510		      10  DFHPT 			PIC X.
   511       *                                              EBCDIC X'05'.
   512       *                                              ASCII  X'09'.
   513		  05  DFHRA-VAL VALUE 060		PIC S9(4) COMP-4.
   514		      88 DFHRA-VAL-EBCDIC		VALUE 60.
   515		      88 DFHRA-VAL-ASCII		VALUE 20.
   516		  05  FILLER REDEFINES DFHRA-VAL.
   517		      10  FILLER			PIC X.
   518		      10  DFHRA 			PIC X.
   519       *                                              EBCDIC x'3C'
   520       *                                              ASCII  x'14'
   521		  05  DFHSFE-VAL VALUE 041		PIC S9(4) COMP-4.
   522		      88 DFHSFE-VAL-EBCDIC		VALUE 41.
   523		      88 DFHSFE-VAL-ASCII		VALUE 31.
   524		  05  FILLER REDEFINES DFHSFE-VAL.
   525		      10  FILLER			PIC X.
   526		      10  DFHSFE			PIC X.
   527       *                                              EBCDIC x'29'
   528       *                                              ASCII  x'1F'
   529		  05  DFHMF-VAL VALUE 044		PIC S9(4) COMP-4.
   530		      88 DFHMF-VAL-EBCDIC		VALUE 44.
   531		      88 DFHMF-VAL-ASCII		VALUE 23.
   532		  05  FILLER REDEFINES DFHMF-VAL.
   533		      10  FILLER			PIC X.
   534		      10  DFHMF 			PIC X.
   535       *                                              EBCDIC x'2C'
   536       *                                              ASCII  x'17'
   537	     *
   538	     ******************************************************************
   539	     *	  unsupported 327X Data Stream order codes
   540	     *
   541		  05  DFHSA-VAL VALUE 040		PIC S9(4) COMP-4.
   542		      88 DFHSA-VAL-EBCDIC		VALUE 40.
   543		      88 DFHSA-VAL-ASCII		VALUE 21.
   544		  05  FILLER REDEFINES DFHSA-VAL.
   545		      10  FILLER			PIC X.
   546		      10  DFHSA 			PIC X.
   547       *                                              EBCDIC x'28'
   548       *                                              ASCII  x'15'   549		  05  DFHGE-VAL VALUE 008		PIC S9(4) COMP-4.
   550		  05  FILLER REDEFINES DFHGE-VAL.
   551		      10  FILLER			PIC X.
   552		      10  DFHGE 			PIC X.
   553       *                                              X'08'.
   554	     *
   555	     ******************************************************************
   556	     *	  SFE and MF supported attribute types
   557	     *
   558            05  DFHCOLOR                          PIC X VALUE 'ƒ'.
   559       *                                              EBCDIC x'42'
   560       *                                              ASCII  x'83'
   561            05  DFHHLT                            PIC X VALUE 'Ö'.
   562       *                                              EBCDIC x'41'
   563       *                                              ASCII  x'D6'
   564            05  DFH3270                           PIC X VALUE '{'.
   565	     *
   566	     *	  supported for SEND TEXT command and printer terminal
   567	     *
   568		  05  DFHBMPNL-VAL VALUE 021		PIC S9(4) COMP-4.
   569		      88 DFHBMPNL-VAL-EBCDIC		VALUE 21.
   570		      88 DFHBMPNL-VAL-ASCII		VALUE 10.
   571		  05  FILLER REDEFINES DFHBMPNL-VAL.
   572		      10  FILLER			PIC X.
   573		      10  DFHBMPNL			PIC X.
   574       *                                              EBCDIC X'15'.
   575       *                                              ASCII  X'0A'.
   576	     *
   577	     ******************************************************************
   578	     *	  Printer terminal data stream only
   579	     *
   580		  05  DFHBMPFF-VAL VALUE 012		PIC S9(4) COMP-4.
   581		  05  FILLER REDEFINES DFHBMPFF-VAL.
   582		      10  FILLER			PIC X.
   583		      10  DFHBMPFF			PIC X.
   584       *                                              X'0C'.
   585		  05  DFHBMPCR-VAL VALUE 013		PIC S9(4) COMP-4.
   586		  05  FILLER REDEFINES DFHBMPCR-VAL.
   587		      10  FILLER			PIC X.
   588		      10  DFHBMPCR			PIC X.
   589       *                                              X'0D'.
   590		  05  DFHBMPEM-VAL VALUE 025		PIC S9(4) COMP-4.
   591		  05  FILLER REDEFINES DFHBMPEM-VAL.
   592		      10  FILLER			PIC X.
   593		      10  DFHBMPEM			PIC X.
   594       *                                              X'19'.
   595	     *
   596	     ******************************************************************
   597	     *	  unsupported Miscellaneous attributes and constants
   598	     *
   599		  05  DFHALL				PIC X VALUE LOW-VALUES.
   600            05  DFHBASE                           PIC X VALUE '0'.
   601		  05  DFHBMDET				PIC X VALUE LOW-VALUES.
   602		  05  DFHBMPSOSI-VAL VALUE 3599 	PIC S9(4) COMP-4.
   603		  05  FILLER REDEFINES DFHBMPSOSI-VAL.
   604		      10  DFHBMPSO			PIC X.
   605       *                                              X'0E'.
   606		      10  DFHBMPSI			PIC X.
   607       *                                              X'0F'.
   608		  05  DFHDFT VALUE HIGH-VALUES		PIC X.   609            05  DFHERROR                          PIC X VALUE '¶'.
   610       *                                              EBCDIC X'1A'.
   611       *                                              ASCII  X'B6'.
   612            05  DFHFIL                            PIC X VALUE '4'.
   613            05  DFHMENT                           PIC X VALUE '2'.
   614            05  DFHMET                            PIC X VALUE '3'.
   615            05  DFHMFE                            PIC X VALUE '6'.
   616            05  DFHMFET                           PIC X VALUE '7'.
   617            05  DFHMFT                            PIC X VALUE '5'.
   618            05  DFHMT                             PIC X VALUE '1'.
   619            05  DFHOUTLN                          PIC X VALUE 'B'.
   620            05  DFHPS                             PIC X VALUE '„'.
   621       *                                              EBCDIC x'43'
   622       *                                              ASCII  x'84'
   623            05  DFHVAL                            PIC X VALUE 'A'.
   624	     *
   625		  05  DFHSUB-VAL   VALUE 063		PIC S9(4) COMP-4.
   626		      88 DFHSUB-VAL-EBCDIC		VALUE 63.
   627		      88 DFHSUB-VAL-ASCII		VALUE 26.
   628		  05  FILLER REDEFINES DFHSUB-VAL.
   629		      10  FILLER			PIC X.
   630		      10  DFHSUB			PIC X.
   631       *                                              EBCDIC X'3F'.
   632       *                                              ASCII  X'1A'.
   633	     *
   634		  05  DFHFM-VAL    VALUE 030		PIC S9(4) COMP-4.
   635		  05  FILLER REDEFINES DFHFM-VAL.
   636		      10  FILLER			PIC X.
   637		      10  DFHFM 			PIC X.
   638       *                                              EBCDIC X'1E'.
   639		  05  DFHEO VALUE HIGH-VALUE		PIC X.
   641
   642	      01  WS-COMMAREA.
   643		  05 WS-PGMID				PIC X(06).
   644		  05 WS-STATE				PIC X.
   645		  05 WS-TICKET-PASSED			PIC X(07).
   646		  05 USERID.
   647		     10  USERID7			PIC X(7).
   648		     10  FILLER 			PIC X(1).
   649		  05 USR-TYPE.
   650		     15 USR-REQUESTOR			PIC X.
   651		     15 USR-ADMIN			PIC X.
   652		     15 USR-APPROVER			PIC X.
   653		     15 USR-SERVICE			PIC X.
   654		  05 WS-SM012-STATE			PIC X.
   655		  05 WS-SM012-PGMID			PIC X(06).
   656		  05 WS-TICKET-NUM			PIC X(07).
   657		  05 WS-FLAG				PIC X(01).
   658		  05 ESC-BACKUP.
   659		     10 WS-E-TITLE			PIC X(25).
   660		     10 WS-E-DES			PIC X(100).
   661		     10 WS-E-STATS			PIC X(10).
   662		     10 WS-E-UPDATE			PIC X(50).
   663
   664	      LINKAGE SECTION.
   666	      01  DFHEIBLK.						       R
   667		  05 EIBTIME  PIC S9(7) COMP-3. 			       R
   668		  05 EIBDATE  PIC S9(7) COMP-3. 			       R
   669		  05 EIBTRNID PIC X(4). 				       R
   670		  05 EIBTASKN PIC S9(7) COMP-3. 			       R   671		  05 EIBTRMID PIC X(4). 				       R
   672		  05 DFHEIGDI PIC S9(4) COMP-4. 			       R
   673		  05 EIBCPOSN PIC S9(4) COMP-4. 			       R
   674		  05 EIBCALEN PIC S9(4) COMP-4. 			       R
   675		  05 EIBAID   PIC X.					       R
   676		  05 EIBFN    PIC X(2). 				       R
   677		  05 EIBRCODE PIC X(6). 				       R
   678		  05 EIBDS    PIC X(8). 				       R
   679		  05 EIBREQID PIC X(8). 				       R
   680		  05 EIBRSRCE PIC X(8). 				       R
   681		  05 EIBSYNC  PIC X.					       R
   682		  05 EIBFREE  PIC X.					       R
   683		  05 EIBRECV  PIC X.					       R
   684		  05 EIBSEND  PIC X.					       R
   685		  05 EIBATT   PIC X.					       R
   686		  05 EIBEOC   PIC X.					       R
   687		  05 EIBFMH   PIC X.					       R
   688		  05 EIBCOMPL PIC X.					       R
   689		  05 EIBSIG   PIC X.					       R
   690		  05 EIBCONF  PIC X.					       R
   691		  05 EIBERR   PIC X.					       R
   692		  05 EIBERRCD PIC X(4). 				       R
   693		  05 EIBSYNRB PIC X.					       R
   694		  05 EIBNODAT PIC X.					       R
   695		  05 EIBRESP  PIC S9(8) COMP-4. 			       R
   696		  05 EIBRESP2 PIC S9(8) COMP-4. 			       R
   697		  05 EIBRLDBK PIC X.					       R
   698		  05 EIBCARESERVED PIC X(32).				       R
   700	      01  DFHCOMMAREA.
   701		  05 DF-PGMID				PIC X(06).
   702		  05 DF-STATE				PIC X.
   703		  05 DF-TICKET-PASSED			PIC X(07).
   704		  05 DF-USERID.
   705		     10  DF-USERID7			PIC X(7).
   706		     10  FILLER 			PIC X(1).
   707		  05 DF-USR-TYPE.
   708		    15 DF-USR-REQUESTOR 		PIC X.
   709		    15 DF-USR-ADMIN			PIC X.
   710		    15 DF-USR-APPROVER			PIC X.
   711		    15 DF-USR-SERVICE			PIC X.
   712		  05 DF-SM012-STATE			PIC X.
   713		  05 DF-SM012-PGMID			PIC X(06).
   714		  05 DF-TICKET-NUM			PIC X(07).
   715		  05 DF-FLAG				PIC X(01).
   716		  05 DF-ESC-BACKUP.
   717		    10 DF-E-TITLE			PIC X(25).
   718		    10 DF-E-DES 			PIC X(100).
   719		    10 DF-E-STATS			PIC X(10).
   720		    10 DF-E-UPDATE			PIC X(50).
   721
   722	      PROCEDURE DIVISION					       R
   724		  USING DFHEIBLK DFHCOMMAREA.				       R
   749	      100-MAIN.
   751		  EXEC CICS IGNORE CONDITION
   752			    ERROR
   753		  END-EXEC
   768
   769		  MOVE DFHCOMMAREA  TO WS-COMMAREA
   770
   771            IF WS-STATE  = 'A' OR   772                WS-STATE   = 'B' OR
   773                WS-STATE   = 'C' OR
   774		      WS-STATE	 =  SPACE
   775		     CONTINUE
   776		  ELSE
   777		     MOVE SPACE TO WS-STATE
   778		  END-IF
   779
   780		  IF WS-TICKET-PASSED  NOT = SPACE AND WS-STATE = SPACE
   781               MOVE 'A' TO WS-STATE
   782		     MOVE WS-TICKET-PASSED  TO WS-TICKET-NUM
   783		  END-IF
   784
   785            IF WS-PGMID = 'SM000' OR WS-PGMID = 'SM001' OR
   786               WS-PGMID = 'SM012'
   787		     PERFORM 4000-RMAP
   788		     IF IDI NOT = NULL
   789		       MOVE IDI TO WS-TICKET-NUM
   790		     END-IF
   791		     PERFORM 2000-CHECK-AID
   792
   793		     EVALUATE TRUE
   794		       WHEN WS-STATE = SPACE
   795			 MOVE DFHBMUNP TO IDA
   796			 MOVE -1 TO IDL
   797			 MOVE DFHBMPRO TO TICKETTA
   798			 MOVE DFHBMPRO TO TICKTD1A
   799			 MOVE DFHBMPRO TO TICKTD2A
   800
   801                 WHEN WS-STATE = 'A'
   802			 PERFORM 3000-READ-RECORD
   803
   804                 WHEN WS-STATE = 'B'
   805			 MOVE -1 TO TICKETTL
   806
   807                 WHEN WS-STATE = 'C'
   808			PERFORM 3200-READ-ONLY
   809			PERFORM 2110-STATEA-FLAGY
   810			MOVE DFHBMPRO TO IDA
   811			MOVE DFHBMPRO TO TICKETTA
   812			MOVE DFHBMPRO TO TICKTD1A
   813			MOVE DFHBMPRO TO TICKTD2A
   814			MOVE DFHBMPRO TO REQA
   815			MOVE DFHBMPRO TO STATSA
   816			MOVE DFHBMPRO TO UPBA
   817			MOVE DFHBMPRO TO UPR1A
   818			MOVE DFHBMPRO TO UPR2A
   819			MOVE DFHBMPRO TO UPDATEA
   820			MOVE DFHBMPRO TO UPTIMEA
   821			MOVE -1 TO IDL
   822
   823		     END-EVALUATE
   824
   825		     PERFORM 2100-CHECK-AID-MSG
   826		     PERFORM 1000-NEW-MAP
   827		  ELSE
   828		     PERFORM 110-INVALID
   829		  END-IF.
   830	      100-EXIT. EXIT.
   831   832	      110-INVALID.
   834		  EXEC CICS SEND TEXT
   835		     FROM (WS-END)
   836		     LENGTH (+15)
   837		     ERASE
   838		  END-EXEC
   869		  EXEC CICS RETURN
   870		  END-EXEC.
   884	      110-EXIT. EXIT.
   885
   886	      1000-NEW-MAP.
   887            MOVE 'SM003' TO MAPTO
   888		  MOVE EIBDATE TO WS-DATE
   889		  MOVE WS-DATE-X TO DATEO
   891		  EXEC CICS ASKTIME
   892		    ABSTIME    (WS-TIME)
   893		  END-EXEC
   912		  EXEC CICS FORMATTIME
   913		    ABSTIME    (WS-TIME)
   914              DATESEP    ('-')
   915		    MMDDYYYY   (DATEO)
   916		    TIME       (TIMEO)
   917              TIMESEP    (':')
   918		  END-EXEC
   958		  MOVE DFHBMASB TO MAPTA
   959		  MOVE DFHBMASB TO TIMEA
   960		  MOVE DFHBMASB TO DATEA
   961		  MOVE DFHBMASB TO ERRMSGA
   962		  MOVE DFHBMASK TO STA
   963		  MOVE DFHBMASK TO UPMA
   964		  MOVE DFHBMASK TO UPDTA
   965		  MOVE LENGTH OF SM003MO TO WS-LENGTH
   967			      EXEC CICS
   968                                 SEND MAP('SM003M')
   969                                 MAPSET('SM03S')
   970				       FROM(SM003MO)
   971				       LENGTH(WS-LENGTH)
   972		     CURSOR
   973		     ERASE
   974				    END-EXEC
  1020		  EXEC CICS RETURN
  1021               TRANSID('SM03')
  1022		       COMMAREA(WS-COMMAREA)
  1023		     LENGTH(207)
  1024			END-EXEC.
  1055	      1000-EXIT. EXIT.
  1056
  1057	      2000-CHECK-AID.
  1058		  EVALUATE TRUE
  1059		   WHEN EIBAID = DFHPF2
  1060               IF WS-STATE = 'B' AND  WS-FLAG = 'V'
  1061		      PERFORM 3000-READ-RECORD
  1062		      IF WS-E-TITLE = NEW-TICKET-Title AND
  1063			 WS-E-DES = NEW-TICKET-Description AND
  1064			 WS-E-STATS = NEW-TICKET-Status AND
  1065			 WS-E-UPDATE = NEW-TICKET-Update-Remarks
  1066
  1067                   MOVE 'W'  TO WS-FLAG
  1068		      ELSE
  1069                   MOVE 'K' TO WS-FLAG  1070
  1071		      END-IF
  1072
  1073		     END-IF
  1074
  1075		   WHEN EIBAID = DFHPF3
  1076              IF WS-STATE = 'C' OR 'A'
  1077		      EVALUATE WS-PGMID
  1078                  WHEN 'SM000'
  1080			     EXEC CICS XCTL
  1081                                            PROGRAM('SM000')
  1082						  COMMAREA(WS-COMMAREA)
  1083						  LENGTH(133)
  1084			     END-EXEC
  1114                  WHEN 'SM001'
  1116			     EXEC CICS XCTL
  1117                                            PROGRAM('SM001')
  1118						  COMMAREA(WS-COMMAREA)
  1119						  LENGTH(133)
  1120			     END-EXEC
  1150                  WHEN 'SM012'
  1152			      EXEC CICS XCTL
  1153                                            PROGRAM('SM001')
  1154						  COMMAREA(WS-COMMAREA)
  1155						  LENGTH(133)
  1156			     END-EXEC
  1186		      END-EVALUATE
  1187		    END-IF
  1188
  1189		   WHEN EIBAID = DFHPF5
  1190               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1191		       MOVE SPACE TO WS-STATE
  1192		       MOVE NULL TO WS-TICKET-NUM
  1193	     *	       MOVE NULL TO MAP3I
  1194		     END-IF
  1195
  1196		   WHEN EIBAID = DFHENTER
  1197		     IF WS-STATE = SPACE
  1198		       IF WS-TICKET-NUM = NULL
  1199			 CONTINUE
  1200		       ELSE
  1201                   MOVE 'A' TO WS-STATE
  1202		       END-IF
  1203		     END-IF
  1204
  1205               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1206                   MOVE 'N' TO WS-FLAG
  1207		     END-IF
  1208
  1209               IF WS-STATE = 'C' AND WS-FLAG = 'N'
  1210			MOVE SPACE TO WS-STATE
  1211			MOVE NULL TO WS-TICKET-NUM
  1212	     *		MOVE NULL TO MAP3I
  1213		     END-IF
  1214
  1215		   WHEN EIBAID = DFHCLEAR
  1216		     CONTINUE
  1217
  1218		   WHEN EIBAID = DFHPF12
  1219		     CONTINUE  1220
  1221		   WHEN OTHER
  1222		     CONTINUE
  1223
  1224		  END-EVALUATE.
  1225	      2000-EXIT. EXIT.
  1226
  1227	      2100-CHECK-AID-MSG.
  1228		  EVALUATE TRUE
  1229		   WHEN EIBAID = DFHPF2
  1230		     IF WS-STATE = SPACE
  1231                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1232		     END-IF
  1233
  1234               IF WS-STATE = 'A'
  1235		       MOVE -1 TO IDL
  1236		       MOVE DFHBMUNP TO IDA
  1237		       MOVE WS-TICKET-NUM TO IDO
  1238                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1239		     END-IF
  1240
  1241		     EVALUATE TRUE
  1242
  1243               WHEN WS-STATE = 'B' AND WS-FLAG = 'W'
  1244		       MOVE -1 TO TICKETTL
  1245                 MOVE 'NO CHANGES' TO ERRMSGO
  1246                 MOVE 'N' TO WS-FLAG
  1247		       PERFORM 2120-STATEB
  1248
  1249               WHEN WS-STATE = 'B' AND WS-FLAG = 'N'
  1250		       PERFORM 3000-READ-RECORD
  1251		       PERFORM 2120-STATEB
  1252                 MOVE 'PRESS ENTER TO VALIDATE' TO ERRMSGO
  1253
  1254              WHEN WS-STATE = 'B' AND WS-FLAG = 'Y'
  1255		       PERFORM 3000-READ-RECORD
  1256		       PERFORM 2120-STATEB
  1257                 MOVE 'PRESS ENTER TO VALIDATE' TO ERRMSGO
  1258
  1259		     END-EVALUATE
  1260
  1261               IF WS-STATE = 'C' AND WS-FLAG = 'N'
  1262                  MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1263		     END-IF
  1264
  1265               IF WS-STATE = 'B' AND WS-FLAG = 'K'
  1266			PERFORM 3500-CHECK-EDIT
  1267			PERFORM 3100-UPDATE-FILE
  1268			MOVE WS-TICKET-NUM TO WS-LOG-Ticket-ID
  1269			MOVE 0 TO WS-LOG-Seq-Number
  1270			PERFORM 3400-CREATE-LOG
  1271			PERFORM 2110-STATEA-FLAGY
  1272			MOVE DFHBMPRO TO IDA
  1273			MOVE DFHBMPRO TO TICKETTA
  1274			MOVE DFHBMPRO TO TICKTD1A
  1275			MOVE DFHBMPRO TO TICKTD2A
  1276			MOVE DFHBMPRO TO REQA
  1277			MOVE DFHBMPRO TO STATSA
  1278			MOVE DFHBMPRO TO UPBA
  1279			MOVE DFHBMPRO TO UPR1A  1280			MOVE DFHBMPRO TO UPR2A
  1281			MOVE DFHBMPRO TO UPDATEA
  1282			MOVE DFHBMPRO TO UPTIMEA
  1283
  1284              MOVE 'TICKET UPDATED, PRESS ENTER TO UPDATE ANOTHER TICKET'
  1285		      TO ERRMSGO
  1286                  MOVE 'N' TO WS-FLAG
  1287                  MOVE 'C' TO WS-STATE
  1288
  1289		     END-IF
  1290
  1291		   WHEN EIBAID = DFHPF5
  1292		     IF WS-STATE = SPACE
  1293                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1294		     END-IF
  1295
  1296               IF WS-STATE = SPACE AND WS-FLAG = 'Y'
  1297                 MOVE 'UPDATE ABORTED' TO ERRMSGO
  1298		       MOVE NULL TO WS-FLAG
  1299		     END-IF
  1300
  1301               IF WS-STATE = 'A'
  1302		       MOVE -1 TO IDL
  1303		       MOVE DFHBMUNP TO IDA
  1304		       MOVE WS-TICKET-NUM TO IDO
  1305                 MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1306		     END-IF
  1307
  1308               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1309		       PERFORM 3000-READ-RECORD
  1310		       PERFORM 2110-STATEA-FLAGY
  1311                 MOVE 'UPDATE ABORTED' TO ERRMSGO
  1312                 MOVE 'Y' TO WS-FLAG
  1313		       MOVE DFHBMPRO TO IDA
  1314		     END-IF
  1315
  1316               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1317		       PERFORM 3000-READ-RECORD
  1318		       PERFORM 2110-STATEA-FLAGY
  1319                 MOVE 'N' TO WS-FLAG
  1320                 MOVE 'UPDATE ABORTED' TO ERRMSGO
  1321		       MOVE DFHBMPRO TO IDA
  1322		     END-IF
  1323
  1324               IF WS-STATE = 'C' AND WS-FLAG = 'N'
  1325                  MOVE 'DISABLED PFKEY PRESSED' TO ERRMSGO
  1326		     END-IF
  1327
  1328		   WHEN EIBAID = DFHENTER
  1329		     IF WS-STATE = SPACE AND WS-TICKET-NUM = NULL
  1330                 MOVE 'ENTER TICKET NUMBER AND PRESS ENTER' TO ERRMSGO
  1331		     END-IF
  1332
  1333               IF WS-STATE = 'A' AND WS-FLAG = 'N'
  1334		       MOVE -1 TO IDL
  1335		       MOVE DFHBMUNP TO IDA
  1336		       MOVE WS-TICKET-NUM TO IDO
  1337                 MOVE 'TICKET NUMBER DOES NOT EXIST' TO ERRMSGO
  1338		     END-IF
  1339  1340               IF WS-STATE = 'A' AND WS-FLAG = 'S'
  1341		       MOVE -1 TO IDL
  1342		       MOVE DFHBMUNP TO IDA
  1343		       MOVE WS-TICKET-NUM TO IDO
  1344                 MOVE 'INVALID TICKET STATUS' TO ERRMSGO
  1345		     END-IF
  1346
  1347               IF WS-STATE = 'A' AND WS-FLAG = 'R'
  1348		       MOVE -1 TO IDL
  1349		       MOVE DFHBMUNP TO IDA
  1350		       MOVE WS-TICKET-NUM TO IDO
  1351                 MOVE 'INVALID ACCESS TO THE TICKET' TO ERRMSGO
  1352		     END-IF
  1353
  1354               IF WS-STATE = 'A' AND WS-FLAG = 'Y'
  1355		       PERFORM 2110-STATEA-FLAGY
  1356                 MOVE 'B' TO WS-STATE
  1357		       MOVE DFHBMPRO TO IDA
  1358		       MOVE -1 TO TICKETTL
  1359                 MOVE 'ENTER UPDATES' TO ERRMSGO
  1360		     END-IF
  1361
  1362               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1363		       PERFORM 3000-READ-RECORD
  1364		       PERFORM 2120-STATEB
  1365                 MOVE 'PRESS PF2 TO UPDATE TICKET' TO ERRMSGO
  1366		     END-IF
  1367
  1368               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1369		       EVALUATE TRUE
  1370			 WHEN TICKETTI = SPACE
  1371			   MOVE -1 TO TICKETTL
  1372                     MOVE 'TICKET TITLE IS REQUIRED' TO ERRMSGO
  1373			 WHEN TICKTD1I = SPACE
  1374			   MOVE -1 TO TICKTD1L
  1375                     MOVE 'DESCRIPTION IS REQUIRED' TO ERRMSGO
  1376                   WHEN STATSI  NOT = 'ONGOING' AND 'COMPLETED'
  1377			   MOVE -1 TO STATSL
  1378                     MOVE 'STATUS IS NOT VALID' TO ERRMSGO
  1379			 WHEN UPR1I = SPACE
  1380			   MOVE -1 TO UPR1L
  1381                     MOVE 'UPDATE REMARKS IS REQUIRED' TO ERRMSGO
  1382			 WHEN OTHER
  1383                     MOVE 'PRESS PF2 TO UPDATE TICKET' TO ERRMSGO
  1384                     MOVE 'V' TO WS-FLAG
  1385		       END-EVALUATE
  1386		       MOVE TICKETTI TO WS-E-TITLE
  1387		       MOVE TICKTD1I TO WS-E-DES(1:50)
  1388		       MOVE TICKTD2I TO WS-E-DES(51:50)
  1389		       MOVE STATSI TO WS-E-STATS
  1390		       MOVE UPR1I TO WS-E-UPDATE(1:25)
  1391		       MOVE UPR2I TO WS-E-UPDATE(26:25)
  1392		       PERFORM 3000-READ-RECORD
  1393		       PERFORM 2120-STATEB
  1394		     END-IF
  1395
  1396		   WHEN EIBAID = DFHCLEAR
  1397               IF WS-STATE = 'A'
  1398		       MOVE -1 TO IDL
  1399		       MOVE DFHBMUNP TO IDA  1400		       MOVE WS-TICKET-NUM TO IDO
  1401		     END-IF
  1402
  1403               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1404		       PERFORM 3000-READ-RECORD
  1405		       PERFORM 2110-STATEA-FLAGY
  1406		       MOVE DFHBMPRO TO IDA
  1407		     END-IF
  1408
  1409               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1410		       PERFORM 3000-READ-RECORD
  1411		       PERFORM 2110-STATEA-FLAGY
  1412		       MOVE DFHBMPRO TO IDA
  1413		     END-IF
  1414
  1415               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1416		       PERFORM 3000-READ-RECORD
  1417		       PERFORM 2120-STATEB
  1418		       MOVE WS-E-TITLE TO TICKETTO
  1419		       MOVE WS-E-DES(1:50) TO TICKTD1O
  1420		       MOVE WS-E-DES(51:50) TO TICKTD2O
  1421		       MOVE WS-E-STATS TO STATSO
  1422		       MOVE WS-E-UPDATE(1:25) TO UPR1O
  1423		       MOVE WS-E-UPDATE(26:25) TO UPR2O
  1424		     END-IF
  1425
  1426               MOVE 'INVALID PFKEY PRESSED' TO ERRMSGO
  1427
  1428		   WHEN EIBAID = DFHPF12
  1429                  MOVE 'SM005' TO WS-SM012-PGMID
  1430	     *		MOVE LOW-VALUES TO WS-STATE
  1431			MOVE LOW-VALUES TO WS-SM012-STATE
  1433			EXEC CICS XCTL
  1434                       PROGRAM('SM012')
  1435			     COMMAREA(WS-COMMAREA)
  1436			END-EXEC
  1460
  1461		   WHEN OTHER
  1462               IF WS-STATE = 'A'
  1463		       MOVE -1 TO IDL
  1464		       MOVE DFHBMUNP TO IDA
  1465		       MOVE WS-TICKET-NUM TO IDO
  1466		     END-IF
  1467
  1468               IF WS-STATE = 'B' AND WS-FLAG = 'N'
  1469		       PERFORM 3000-READ-RECORD
  1470		       PERFORM 2110-STATEA-FLAGY
  1471		       MOVE DFHBMPRO TO IDA
  1472		     END-IF
  1473
  1474               IF WS-STATE = 'B' AND WS-FLAG = 'Y'
  1475		       PERFORM 3000-READ-RECORD
  1476		       PERFORM 2110-STATEA-FLAGY
  1477		       MOVE DFHBMPRO TO IDA
  1478		     END-IF
  1479
  1480               IF WS-STATE = 'B' AND WS-FLAG = 'V'
  1481		       PERFORM 3000-READ-RECORD
  1482		       PERFORM 2120-STATEB
  1483		       MOVE WS-E-TITLE TO TICKETTO  1484		       MOVE WS-E-DES(1:50) TO TICKTD1O
  1485		       MOVE WS-E-DES(51:50) TO TICKTD2O
  1486		       MOVE WS-E-STATS TO STATSO
  1487		       MOVE WS-E-UPDATE(1:25) TO UPR1O
  1488		       MOVE WS-E-UPDATE(26:25) TO UPR2O
  1489		     END-IF
  1490
  1491
  1492               MOVE 'INVALID PFKEY PRESSED' TO ERRMSGO
  1493
  1494		  END-EVALUATE.
  1495	      2100-EXIT. EXIT.
  1496
  1497	      2110-STATEA-FLAGY.
  1498		   MOVE NEW-TICKET-KEY TO IDO
  1499		   MOVE NEW-TICKET-Title TO TICKETTO
  1500		   MOVE NEW-TICKET-Description(1:50) TO TICKTD1O
  1501		   MOVE NEW-TICKET-Description(51:50) TO TICKTD2O
  1502		   MOVE NEW-TICKET-Requestor TO REQO
  1503		   MOVE NEW-TICKET-Status  TO STATSO
  1504		   MOVE NEW-TICKET-Last-Update-by TO UPBO
  1505		   MOVE NEW-TICKET-Update-Remarks(1:25) TO UPR1O
  1506		   MOVE NEW-TICKET-Update-Remarks(26:25) TO UPR2O
  1507		   MOVE NEW-TICKET-Last-Update(1:10) TO UPDATEO
  1508		   MOVE NEW-TICKET-Last-Update(12:09) TO  UPTIMEO.
  1509	      2110-EXIT. EXIT.
  1510
  1511	      2120-STATEB.
  1512		   MOVE NEW-TICKET-KEY TO IDO
  1513		   MOVE NEW-TICKET-Requestor TO REQO
  1514		   MOVE NEW-TICKET-Last-Update-by TO UPBO
  1515		   MOVE NEW-TICKET-Last-Update(1:10) TO UPDATEO
  1516		   MOVE NEW-TICKET-Last-Update(12:09) TO  UPTIMEO
  1517		   MOVE DFHBMPRO TO IDA.
  1518	      2120-EXIT. EXIT.
  1519
  1520
  1521
  1522	      3000-READ-RECORD.
  1524		  EXEC CICS STARTBR
  1525                 FILE('STF001C')
  1526		       RIDFLD (WS-TICKET-NUM)
  1527		       GTEQ
  1528		  END-EXEC
  1555		  IF EIBRESP = +0
  1557		   EXEC CICS
  1558                  READ FILE('STF001C')
  1559			INTO (NEW-TICKET)
  1560			RIDFLD (WS-TICKET-NUM)
  1561			EQUAL
  1562			UPDATE
  1563		   END-EXEC
  1598             IF NEW-TICKET-Status = 'APPROVED' OR 'ONGOING'
  1599                 IF WS-STATE = 'A'
  1600	     ****I FFIX PA YUN REQUESTOR GALING SA COMMAREA
  1601	     ***************REQUESTOR USER
  1602                   IF USR-REQUESTOR = 'Y'
  1603			   IF USERID = NEW-TICKET-Requestor
  1604                       MOVE 'Y' TO WS-FLAG
  1605			   ELSE  1606                       MOVE 'R' TO WS-FLAG
  1607			   END-IF
  1608			 END-IF
  1609	     ***************SERVICE PROVIDER USER
  1610                   IF USR-SERVICE = 'Y'
  1611                     MOVE 'Y' TO WS-FLAG
  1612			 END-IF
  1613		       END-IF
  1614		   ELSE
  1615               MOVE 'S' TO WS-FLAG
  1616		   END-IF
  1617		  ELSE
  1618             MOVE 'N' TO WS-FLAG
  1619		  END-IF.
  1620	      3000-EXIT. EXIT.
  1621
  1622	      3100-UPDATE-FILE.
  1623		  MOVE WS-E-TITLE TO NEW-TICKET-Title
  1624		  MOVE WS-E-DES TO NEW-TICKET-Description
  1625		  MOVE WS-E-STATS TO NEW-TICKET-Status
  1626		  MOVE WS-E-UPDATE TO NEW-TICKET-Update-Remarks
  1628		  EXEC CICS ASKTIME
  1629		   ABSTIME    (WS-TIME)
  1630		  END-EXEC
  1649		  EXEC CICS FORMATTIME
  1650		    ABSTIME    (WS-TIME)
  1651              DATESEP    ('/')
  1652		    MMDDYYYY   (DATEO)
  1653		    TIME       (TIMEO)
  1654              TIMESEP    (':')
  1655		  END-EXEC
  1695		  MOVE DATEO	TO NEW-TICKET-Last-Update(1:10)
  1696		  MOVE TIMEO	TO NEW-TICKET-Last-Update(12:09)
  1697		  MOVE USERID	TO NEW-TICKET-Last-Update-by
  1699		  EXEC CICS
  1700              REWRITE FILE ('STF001C')
  1701		    FROM (NEW-TICKET)
  1702		    RESP(WS-RETNCODE)
  1703		  END-EXEC.
  1734
  1735	      3100-EXIT. EXIT.
  1736
  1737	      3200-READ-ONLY.
  1739		  EXEC CICS STARTBR
  1740               FILE('STF001C')
  1741		     RIDFLD (WS-TICKET-NUM)
  1742		     GTEQ
  1743		  END-EXEC
  1770		  IF EIBRESP = +0
  1772		   EXEC CICS
  1773               READ FILE('STF001C')
  1774		     INTO (NEW-TICKET)
  1775		     RIDFLD (WS-TICKET-NUM)
  1776		     EQUAL
  1777		     UPDATE
  1778		   END-EXEC.
  1814	      3200-EXIT. EXIT.
  1815
  1816	      3300-READ-LOG.
  1817  1819		  EXEC CICS STARTBR
  1820               FILE('STF002E')
  1821		     RIDFLD (WS-KEYS)
  1822		     GTEQ
  1823		  END-EXEC
  1850
  1851		  MOVE WS-LOG TO WS-LOG-BACKUP
  1852
  1853		  PERFORM UNTIL WS-LOG-Ticket-ID NOT = WS-B-LOG-Ticket-ID
  1855		    EXEC CICS READ
  1856                FILE('STF002E')
  1857		      INTO(WS-LOG)
  1858		      RIDFLD(WS-KEYS)
  1859		      GTEQ
  1860		    END-EXEC
  1892		    IF WS-LOG-Ticket-ID  = WS-B-LOG-Ticket-ID
  1893		      MOVE WS-LOG TO WS-LOG-BACKUP
  1894		      ADD 1 TO WS-LOG-Seq-Number
  1895		    END-IF
  1896
  1897		  END-PERFORM
  1898
  1900		  EXEC CICS ENDBR
  1901              FILE('STF002E')
  1902		  END-EXEC.
  1922
  1923	      3300-EXIT. EXIT.
  1924
  1925	      3400-CREATE-LOG.
  1926		  PERFORM 3300-READ-LOG
  1927		  MOVE WS-LOG-BACKUP TO WS-LOG
  1928		  ADD 1 TO WS-LOG-Seq-Number
  1929	     **********ID GALING SA COMMAREA
  1930		  MOVE USERID TO WS-LOG-Last-Update-by
  1931		  MOVE NEW-TICKET-Last-Update-by  TO WS-LOG-Last-Update-by
  1932		  MOVE HOLDER TO WS-LOG-Update-Remarks
  1934		  EXEC CICS
  1935                 WRITE FILE('STF002E')
  1936		       FROM (WS-LOG)
  1937		       RIDFLD (WS-KEYS)
  1938		       RESP(WS-RETNCODE)
  1939		  END-EXEC
  1974
  1975		  ADD 1 TO WS-LOG-Seq-Number
  1976
  1977		  PERFORM 3600-CHECK-NEW
  1978		  MOVE HOLDER TO WS-LOG-Update-Remarks
  1979
  1981		  EXEC CICS
  1982                 WRITE FILE('STF002E')
  1983		       FROM (WS-LOG)
  1984		       RIDFLD (WS-KEYS)
  1985		       RESP(WS-RETNCODE)
  1986		  END-EXEC.
  2022
  2023
  2024	      3400-EXIT. EXIT.
  2025
  2026	      3500-CHECK-EDIT.
  2027  2028		  IF WS-E-TITLE NOT = NEW-TICKET-Title
  2029		    MOVE WS-E-TITLE TO WS-C-TITLE
  2030		  END-IF
  2031
  2032		  IF WS-E-DES NOT = NEW-TICKET-Description
  2033		      MOVE WS-E-DES TO WS-C-DES
  2034		  END-IF
  2035
  2036		  IF WS-E-UPDATE NOT = NEW-TICKET-Update-Remarks
  2037			MOVE WS-E-UPDATE TO WS-C-UPDATE
  2038		  END-IF.
  2039
  2040            IF NEW-TICKET-Status = 'COMPLETED'
  2041		      EVALUATE TRUE
  2042		      WHEN WS-C-TITLE NOT = NULL AND
  2043			   WS-C-DES NOT = NULL AND
  2044			   WS-C-UPDATE NOT = NULL
  2045                     MOVE 'COMPLETED. TITLE/DESCRIPTION/REMARKS UPDATED'
  2046			     TO HOLDER
  2047
  2048		      WHEN WS-C-TITLE NOT = NULL AND
  2049			   WS-C-DES   NOT = NULL AND
  2050			   WS-C-UPDATE	  = NULL
  2051                     MOVE 'COMPLETED. TITLE/DESCRIPTION UPDATED'
  2052			     TO HOLDER
  2053
  2054		      WHEN WS-C-TITLE NOT = NULL AND
  2055			   WS-C-DES	  = NULL AND
  2056			   WS-C-UPDATE	  = NULL
  2057                     MOVE 'COMPLETED. TITLE UPDATED' TO HOLDER
  2058
  2059		      WHEN WS-C-TITLE	   = NULL AND
  2060			   WS-C-DES    NOT  = NULL AND
  2061			   WS-C-UPDATE NOT = NULL
  2062                     MOVE 'COMPLETED. DESCRIPTION/REMARKS UPDATED'
  2063			    TO HOLDER
  2064
  2065		     WHEN WS-C-TITLE	   = NULL AND
  2066			   WS-C-DES	   = NULL AND
  2067			   WS-C-UPDATE NOT = NULL
  2068                     MOVE 'COMPLETED. REMARKS UPDATED' TO HOLDER
  2069
  2070		     WHEN WS-C-TITLE	   = NULL AND
  2071			   WS-C-DES   NOT  = NULL AND
  2072			   WS-C-UPDATE	   = NULL
  2073                     MOVE 'COMPLETED. DESCRIPTION UPDATED' TO HOLDER
  2074
  2075		      WHEN WS-C-TITLE NOT  = NULL AND
  2076			   WS-C-DES	   = NULL AND
  2077			   WS-C-UPDATE NOT = NULL
  2078                     MOVE 'COMPLETED. TITLE/REMARKS UPDATED' TO HOLDER
  2079		      END-EVALUATE
  2080		  ELSE
  2081		      EVALUATE TRUE
  2082		      WHEN WS-C-TITLE NOT = NULL AND
  2083			   WS-C-DES NOT = NULL AND
  2084			   WS-C-UPDATE NOT = NULL
  2085                     MOVE 'TITLE/DESCRIPTION/REMARKS UPDATED' TO HOLDER
  2086
  2087		      WHEN WS-C-TITLE NOT = NULL AND  2088			   WS-C-DES   NOT = NULL AND
  2089			   WS-C-UPDATE	  = NULL
  2090                     MOVE 'TITLE/DESCRIPTION UPDATED' TO HOLDER
  2091
  2092		      WHEN WS-C-TITLE NOT = NULL AND
  2093			   WS-C-DES	  = NULL AND
  2094			   WS-C-UPDATE	  = NULL
  2095                     MOVE 'TITLE UPDATED' TO HOLDER
  2096
  2097		      WHEN WS-C-TITLE	   = NULL AND
  2098			   WS-C-DES    NOT  = NULL AND
  2099			   WS-C-UPDATE NOT = NULL
  2100                     MOVE 'DESCRIPTION/REMARKS UPDATED' TO HOLDER
  2101
  2102		     WHEN WS-C-TITLE	   = NULL AND
  2103			   WS-C-DES	   = NULL AND
  2104			   WS-C-UPDATE NOT = NULL
  2105                     MOVE 'REMARKS UPDATED' TO HOLDER
  2106
  2107		     WHEN WS-C-TITLE	   = NULL AND
  2108			   WS-C-DES   NOT  = NULL AND
  2109			   WS-C-UPDATE	   = NULL
  2110                     MOVE 'DESCRIPTION UPDATED' TO HOLDER
  2111
  2112		      WHEN WS-C-TITLE NOT  = NULL AND
  2113			   WS-C-DES	   = NULL AND
  2114			   WS-C-UPDATE NOT = NULL
  2115                     MOVE 'TITLE/REMARKS UPDATED' TO HOLDER
  2116
  2117		      END-EVALUATE
  2118		  END-IF.
  2119	      3500-EXIT. EXIT.
  2120
  2121	      3600-CHECK-NEW.
  2122		  EVALUATE TRUE
  2123		      WHEN WS-C-TITLE NOT = NULL AND
  2124			   WS-C-DES NOT = NULL AND
  2125			   WS-C-UPDATE NOT = NULL
  2126                  STRING WS-C-TITLE DELIMITED BY ' '
  2127                    ' ' DELIMITED BY SIZE
  2128                    WS-C-DES DELIMITED BY ' '
  2129                    ' ' DELIMITED BY SIZE
  2130                    WS-C-UPDATE DELIMITED BY ' '
  2131			  INTO HOLDER
  2132			END-STRING
  2133
  2134		      WHEN WS-C-TITLE NOT = NULL AND
  2135			   WS-C-DES   NOT = NULL AND
  2136			   WS-C-UPDATE	  = NULL
  2137                  STRING WS-C-TITLE DELIMITED BY ' '
  2138                    ' ' DELIMITED BY SIZE
  2139                    WS-C-DES DELIMITED BY ' '
  2140			  INTO HOLDER
  2141			END-STRING
  2142
  2143		      WHEN WS-C-TITLE NOT = NULL AND
  2144			   WS-C-DES	  = NULL AND
  2145			   WS-C-UPDATE	  = NULL
  2146                  STRING WS-C-TITLE DELIMITED BY ' '
  2147			  INTO HOLDER  2148			END-STRING
  2149
  2150		      WHEN WS-C-TITLE	   = NULL AND
  2151			   WS-C-DES    NOT  = NULL AND
  2152			   WS-C-UPDATE NOT = NULL
  2153                  STRING WS-C-DES DELIMITED BY ' '
  2154                    ' ' DELIMITED BY SIZE
  2155                    WS-C-UPDATE DELIMITED BY ' '
  2156			  INTO HOLDER
  2157			END-STRING
  2158
  2159		     WHEN WS-C-TITLE	   = NULL AND
  2160			   WS-C-DES	   = NULL AND
  2161			   WS-C-UPDATE NOT = NULL
  2162			STRING
  2163                    WS-C-UPDATE DELIMITED BY ' '
  2164			  INTO HOLDER
  2165			END-STRING
  2166
  2167		     WHEN WS-C-TITLE	   = NULL AND
  2168			   WS-C-DES   NOT  = NULL AND
  2169			   WS-C-UPDATE	   = NULL
  2170		       STRING
  2171                    WS-C-DES DELIMITED BY ' '
  2172			  INTO HOLDER
  2173			END-STRING
  2174
  2175		      WHEN WS-C-TITLE NOT  = NULL AND
  2176			   WS-C-DES	   = NULL AND
  2177			   WS-C-UPDATE NOT = NULL
  2178                  STRING WS-C-TITLE DELIMITED BY ' '
  2179                    ' ' DELIMITED BY SIZE
  2180                    WS-C-UPDATE DELIMITED BY ' '
  2181			  INTO HOLDER
  2182			END-STRING
  2183
  2184		      END-EVALUATE.
  2185
  2186	      3600-EXIT. EXIT.
  2187
  2188	      4000-RMAP.
  2190		  EXEC CICS
  2191                 RECEIVE MAP('SM003M')
  2192                 MAPSET('SM03S')
  2193		       INTO (SM003MI)
  2194		  END-EXEC.
  2228	      4000-EXIT. EXIT.
  2229CA-Realia COBOL Version 6.0.45	 D:\work\CAWB30-HO\SM003.cic	       PAGE   25



			Realia COBOL Compiler Version Information

			      Pass 1	 Version 6.072
			      Pass 1a	 Version 6.015
			      Pass 2	 Version 6.068
			      Pass 2a	 Version 6.020
			      Pass 3	 Version 6.094
			      Pass 4	 Version 6.007
			      Pass 5	 Version 6.022


			Compilation Directives in Effect

COMP-4		  DCHK		    OPT 	      NOCALL
NOSUBCHK	  STRCHK	    NOTRUNC	      NOSMALLCOMP
NODCALL 	  NODIVZERO	    NOEPDCALL	      APOST
EBCDIC		  STATABORT	    NOMOVELINK	      NOBLL4K
ARGCHK		  UPLOW 	    NOVERARG	      MDY
LP:   60	  PP		    FCREATE	      NOIEEE
NOLILIAN	  CURRENCY-SIGN=$   WRITEAFTER	      SOSI
NOCOPY68	  NOFLAG-COM	    NOFLAG-SEG	      NOFLAG-FIPS
DEBUGXREF	  DIALECT-VS2

			Error level limit: W

			Source lines compiled:	    2240
			Compilation time (mm:ss.ss):  0:00.70
			Compilation speed (lines/minute): 92000

			Compilation date (yy/mm/dd): 23/12/05
			     Time of day (hh:mm:ss): 11:33:36