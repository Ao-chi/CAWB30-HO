     5	     *CBL XOPTS(COBOL2)
    20	      IDENTIFICATION DIVISION.
    21	      PROGRAM-ID. SM006.
    22
    23	      ENVIRONMENT DIVISION.
    24	      CONFIGURATION SECTION.
    25	      SOURCE-COMPUTER.	  IBM-PC.
    26	      OBJECT-COMPUTER.	  IBM-PC.
    27	      DATA DIVISION.
    28	      FILE SECTION.
    29	     *----------------------------------------------------------------*
    30	     *			      WORKING STORAGE			      *
    31	     *----------------------------------------------------------------*
    32	      WORKING-STORAGE SECTION.
    78	      01  WS-FIELDS.
    79		  05  WS-STD-KEY-LEN			PIC S9(4) COMP VALUE 8.
    80		  05  WS-REC.
    81		      10  WS-USERID.
    82			  15  WS-USERID7		PIC X(7).
    83			  15  FILLER			PIC X(1).
    84		      10  WS-TYPE.
    85			  15  WS-REQUESTOR		PIC X.
    86			  15  WS-ADMIN			PIC X.
    87			  15  WS-APPROVER		PIC X.
    88			  15  WS-SERVICE		PIC X.
    89		      10  WS-UPDATEDBY			PIC X(8).
    90
    91        01  WS-CURRENT-MAP  VALUE 'SM06S'         PIC X(7).
    92	      01  WS-TIME				PIC 9(15) COMP-3.
    93	      01  WS-DATE				PIC 9(10).
    94	      01  WS-DATE-X REDEFINES WS-DATE		PIC X(7).
    95	      01  WS-LENGTH				PIC S9(4) COMP.
    96
    97	      01  WS-ERRMSGS.
    98		  05 WS-INVALID-ACCESS			PIC X(15) VALUE
    99               'INVALID ACCESS'.
   100		  05 WS-INVALID-PGMID			PIC X(20) VALUE
   101               'INVALID USER ACCESS'.
   102		  05 WS-INVALID-TIX-ACC 		PIC X(34) VALUE
   103               'INVALID ACCESS TO SELECTED TICKET'.
   104		  05 WS-FIELD-REQ			PIC X(24) VALUE
   105               'OPTION FIELD IS REQUIRED'.
   106		  05 WS-PRESS-F2			PIC X(30) VALUE
   107               'PRESS PF2 TO CANCEL THE TICKET'.
   108		  05 WS-PRESS-F5			PIC X(51) VALUE
   109              'TICKET CANCEL ABORTED. ENTER TICKET AND PRESS ENTER'.
   110		  05 WS-TICKET-CANCELED 		PIC X(53) VALUE
   111               'TICKET CENCELED, PRESS ENTER TO CANCEL ANOTHER TICKET'.
   112		  05 WS-ENTER-TICKET			PIC X(35) VALUE
   113               'ENTER TICKET NUMBER AND PRESS ENTER'.
   114		  05 WS-NOT-EXIST			PIC X(28) VALUE
   115               'TICKET NUMBER DOES NOT EXIST'.
   116		  05 WS-INVALID-STATUS			PIC X(28) VALUE
   117               'INVALID TICKET STATUS'.
   118		  05 WS-INVALID-PFKEY			PIC X(21) VALUE
   119                'INAVLID PFKEY PRESSED'.
   120
   121        01  WS-FOUND                              PIC X VALUE 'N'.
   122	      77  WS-RETNCODE				PIC S9(8) COMP.
   123	      77  WS-RETNCODE2				PIC S9(8) COMP.   124
   125        01  WS-FLAG                               PIC X(01) VALUE 'N'.
   126
   127	      01  TICKET-FIELDS.
   128		  05 TICKET-SER-KEY-LEN 		PIC S9(04) COMP
   129		      VALUE 7.
   130		  05 TICKET-REC.
   131		     10 TICKET-NUM			   PIC X(07).
   132		     10 TICKET-REQ-BY			   PIC X(08).
   133		     10 TICKET-STATUS			   PIC X(10).
   134		     10 TICKET-TITLE			   PIC X(25).
   135		     10 TICKET-DESC			   PIC X(100).
   136		     10 TICKET-UPDT-TIME		   PIC X(20).
   137		     10 TICKET-UPDT-BY			   PIC X(08).
   138		     10 TICKET-UPDT-REMARKS		   PIC X(50).
   139
   140	      01  WS-TICKET-LOGS.
   141		  05 WS-KEY-LOG.
   142		     10 WS-LOG-TICKET-ID		   PIC X(06).
   143		     10 WS-LOG-SEQ-NUM			   PIC 9(03).
   144		  05 WS-LOG-UPDT-TIME			   PIC X(20).
   145		  05 WS-LOG-UPDT-BY			   PIC X(10).
   146		  05 WS-LOG-UPDT-REMARKS		   PIC X(50).
   147
   148
   149	     *--------------------------------------------------------------*
   150	     *		     COMMAREA WORKING STORAGE			    *
   151	     *--------------------------------------------------------------*
   152	      01  WS-COMMAREA.
   153		  05 WS-PGMID				PIC X(06).
   154		  05 WS-STATE				PIC X.
   155		  05 WS-TICKET-PASSED			PIC X(07).
   156		  05 USERID.
   157		     10  USERID7			PIC X(7).
   158		     10  FILLER 			PIC X(1).
   159		  05 USR-TYPE.
   160		    15 USR-REQUESTOR			PIC X.
   161		    15 USR-ADMIN			PIC X.
   162		    15 USR-APPROVER			PIC X.
   163		    15 USR-SERVICE			PIC X.
   164		  05 WS-SM012-STATE			PIC X.
   165		  05 WS-SM012-PGMID			PIC X(06).
   166		  05 WS-STF01-REC.
   167		     10 WS-STF01-ID			PIC X(07).
   168		     10 FILL1				PIC X(03).
   169		     10 WS-STF01-TITLE			PIC X(25).
   170		     10 FILL2				PIC X(01).
   171		     10 WS-STF01-STATUS 		PIC X(10).
   172		     10 FILL3				PIC X(04).
   173		     10 WS-STF01-LAST-UPD		PIC X(10).
   174		     10 FILL4				PIC X(02).
   175		     10 WS-STF01-LAST-UPDBY		PIC X(8).
   176		     10 WS-STF01-REQ			PIC X(8).
   177		  05 WS-PGMNAME 			PIC  X(6).
   178		  05 WS-DFHSTATE			PIC X(15).
   179		  05 WS-TRANS				PIC X(04).
   180		  05 WS-LUSER				PIC 9(03).
   181		  05 WS-FUSER				PIC X(07).
   182		  05 WS-PAGE				PIC 9(02).
   183		  05 WS-PAGE-END			PIC 9(01).   184		  05 WS-ADDED-USER			PIC X(08).
   185		  05 WS-TICKET-NUMBER			PIC X(07).
   186		  05 WS-FLAG				PIC X(01).
   187		  05 WS-TIX-DETL.
   188		     10 WS-TIX-KEY			PIC X(07).
   189		     10 WS-TIX-KEY-NUM REDEFINES WS-TIX-KEY PIC 9(06).
   190		     10 WS-TIX-REQUESTOR		PIC X(8).
   191		     10 WS-TIX-STATUS			PIC X(10).
   192		     10 WS-TIX-TITLE			PIC X(25).
   193		     10 WS-TIX-DESC			PIC X(100).
   194		     10 WS-TIX-LAST-UPD 		PIC X(20).
   195		     10 WS-TIX-LAST-UPDBY		PIC X(8).
   196		     10 WS-TIX-UPD-REMARKS		PIC X(50).
   197
   198		  COPY SM06S.
   200	     * SYMBOLIC MAP of SM06S Created by CACXBMS Version 6.0.27
   201	      01  SM006MI.
   202		  02  FILLER				     PIC X(12).
   203		  02  TKTNUML				     PIC S9(4) COMP.
   204		  02  TKTNUMF				     PIC X.
   205		  02  FILLER REDEFINES TKTNUMF.
   206		      03  TKTNUMA			     PIC X.
   207		  02  TKTNUMI				     PIC X(006).
   208		  02  REQBYL				     PIC S9(4) COMP.
   209		  02  REQBYF				     PIC X.
   210		  02  FILLER REDEFINES REQBYF.
   211		      03  REQBYA			     PIC X.
   212		  02  REQBYI				     PIC X(008).
   213		  02  TKTLEL				     PIC S9(4) COMP.
   214		  02  TKTLEF				     PIC X.
   215		  02  FILLER REDEFINES TKTLEF.
   216		      03  TKTLEA			     PIC X.
   217		  02  TKTLEI				     PIC X(025).
   218		  02  TKDES1L				     PIC S9(4) COMP.
   219		  02  TKDES1F				     PIC X.
   220		  02  FILLER REDEFINES TKDES1F.
   221		      03  TKDES1A			     PIC X.
   222		  02  TKDES1I				     PIC X(050).
   223		  02  TKDES2L				     PIC S9(4) COMP.
   224		  02  TKDES2F				     PIC X.
   225		  02  FILLER REDEFINES TKDES2F.
   226		      03  TKDES2A			     PIC X.
   227		  02  TKDES2I				     PIC X(050).
   228		  02  STATL				     PIC S9(4) COMP.
   229		  02  STATF				     PIC X.
   230		  02  FILLER REDEFINES STATF.
   231		      03  STATA 			     PIC X.
   232		  02  STATI				     PIC X(010).
   233		  02  UPDTBYL				     PIC S9(4) COMP.
   234		  02  UPDTBYF				     PIC X.
   235		  02  FILLER REDEFINES UPDTBYF.
   236		      03  UPDTBYA			     PIC X.
   237		  02  UPDTBYI				     PIC X(008).
   238		  02  UPDREM1L				     PIC S9(4) COMP.
   239		  02  UPDREM1F				     PIC X.
   240		  02  FILLER REDEFINES UPDREM1F.
   241		      03  UPDREM1A			     PIC X.
   242		  02  UPDREM1I				     PIC X(025).
   243		  02  UPDREM2L				     PIC S9(4) COMP.
   244		  02  UPDREM2F				     PIC X.   245		  02  FILLER REDEFINES UPDREM2F.
   246		      03  UPDREM2A			     PIC X.
   247		  02  UPDREM2I				     PIC X(025).
   248		  02  UPDTL				     PIC S9(4) COMP.
   249		  02  UPDTF				     PIC X.
   250		  02  FILLER REDEFINES UPDTF.
   251		      03  UPDTA 			     PIC X.
   252		  02  UPDTI				     PIC X(020).
   253		  02  PF2L				     PIC S9(4) COMP.
   254		  02  PF2F				     PIC X.
   255		  02  FILLER REDEFINES PF2F.
   256		      03  PF2A				     PIC X.
   257		  02  PF2I				     PIC X(012).
   258		  02  ERRMSGL				     PIC S9(4) COMP.
   259		  02  ERRMSGF				     PIC X.
   260		  02  FILLER REDEFINES ERRMSGF.
   261		      03  ERRMSGA			     PIC X.
   262		  02  ERRMSGI				     PIC X(071).
   263		  02  DATEL				     PIC S9(4) COMP.
   264		  02  DATEF				     PIC X.
   265		  02  FILLER REDEFINES DATEF.
   266		      03  DATEA 			     PIC X.
   267		  02  DATEI				     PIC X(010).
   268		  02  TIMEL				     PIC S9(4) COMP.
   269		  02  TIMEF				     PIC X.
   270		  02  FILLER REDEFINES TIMEF.
   271		      03  TIMEA 			     PIC X.
   272		  02  TIMEI				     PIC X(008).
   273	      01  SM006MO REDEFINES SM006MI.
   274		  02  FILLER				     PIC X(12).
   275		  02  FILLER				     PIC XX.
   276		  02  FILLER				     PIC X.
   277		  02  TKTNUMO				     PIC X(006).
   278		  02  FILLER				     PIC XX.
   279		  02  FILLER				     PIC X.
   280		  02  REQBYO				     PIC X(008).
   281		  02  FILLER				     PIC XX.
   282		  02  FILLER				     PIC X.
   283		  02  TKTLEO				     PIC X(025).
   284		  02  FILLER				     PIC XX.
   285		  02  FILLER				     PIC X.
   286		  02  TKDES1O				     PIC X(050).
   287		  02  FILLER				     PIC XX.
   288		  02  FILLER				     PIC X.
   289		  02  TKDES2O				     PIC X(050).
   290		  02  FILLER				     PIC XX.
   291		  02  FILLER				     PIC X.
   292		  02  STATO				     PIC X(010).
   293		  02  FILLER				     PIC XX.
   294		  02  FILLER				     PIC X.
   295		  02  UPDTBYO				     PIC X(008).
   296		  02  FILLER				     PIC XX.
   297		  02  FILLER				     PIC X.
   298		  02  UPDREM1O				     PIC X(025).
   299		  02  FILLER				     PIC XX.
   300		  02  FILLER				     PIC X.
   301		  02  UPDREM2O				     PIC X(025).
   302		  02  FILLER				     PIC XX.
   303		  02  FILLER				     PIC X.
   304		  02  UPDTO				     PIC X(020).   305		  02  FILLER				     PIC XX.
   306		  02  FILLER				     PIC X.
   307		  02  PF2O				     PIC X(012).
   308		  02  FILLER				     PIC XX.
   309		  02  FILLER				     PIC X.
   310		  02  ERRMSGO				     PIC X(071).
   311		  02  FILLER				     PIC XX.
   312		  02  FILLER				     PIC X.
   313		  02  DATEO				     PIC X(010).
   314		  02  FILLER				     PIC XX.
   315		  02  FILLER				     PIC X.
   316		  02  TIMEO				     PIC X(008).
   318		  COPY DFHAID.
   320	      01  DFHAID.
   321	     *
   322	     * CA-Realia CICS 6.0 Computer Associates International, Inc.
   323	     *
   324	     * Revision Information
   325	     * ^{File:dfhaid.cob  }
   326	     * ^{Timestamp:Thu May 15 14:02:52 1997}
   327	     * ^{Revision:2.0}
   328	     *
   329	     *This is the AID constants copy file
   330	     *
   331            05  DFHENTER                  PIC X VALUE ''''.
   332	     *					value APOST
   333            05  DFHCLEAR                  PIC X VALUE '_'.
   334            05  DFHPA1                    PIC X VALUE '%'.
   335            05  DFHPA2                    PIC X VALUE '>'.
   336            05  DFHPA3                    PIC X VALUE ','.
   337            05  DFHPF1                    PIC X VALUE '1'.
   338            05  DFHPF2                    PIC X VALUE '2'.
   339            05  DFHPF3                    PIC X VALUE '3'.
   340            05  DFHPF4                    PIC X VALUE '4'.
   341            05  DFHPF5                    PIC X VALUE '5'.
   342            05  DFHPF6                    PIC X VALUE '6'.
   343            05  DFHPF7                    PIC X VALUE '7'.
   344            05  DFHPF8                    PIC X VALUE '8'.
   345            05  DFHPF9                    PIC X VALUE '9'.
   346            05  DFHPF10                   PIC X VALUE ':'.
   347            05  DFHPF11                   PIC X VALUE '#'.
   348            05  DFHPF12                   PIC X VALUE '@'.
   349            05  DFHPF13                   PIC X VALUE 'A'.
   350            05  DFHPF14                   PIC X VALUE 'B'.
   351            05  DFHPF15                   PIC X VALUE 'C'.
   352            05  DFHPF16                   PIC X VALUE 'D'.
   353            05  DFHPF17                   PIC X VALUE 'E'.
   354            05  DFHPF18                   PIC X VALUE 'F'.
   355            05  DFHPF19                   PIC X VALUE 'G'.
   356            05  DFHPF20                   PIC X VALUE 'H'.
   357            05  DFHPF21                   PIC X VALUE 'I'.
   358            05  DFHPF22                   PIC X VALUE '›'.
   359       *                                  EBCDIC Cent sign x'4A'
   360       *                                  ASCII  Cent sign x'9B'
   361            05  DFHPF23                   PIC X VALUE '.'.
   362            05  DFHPF24                   PIC X VALUE '<'.
   363            05  DFHOPID                   PIC X VALUE 'W'.
   364            05  DFHMSRE                   PIC X VALUE 'X'.
   365            05  DFHTRIG                   PIC X VALUE '"'.
   366       *                                        value QUOTE  "   367            05  DFHPEN                    PIC X VALUE '='.
   368            05  DFHCLRP                   PIC X VALUE 'Ý'.
   369       *                                  EBCDIC x'6A'
   370       *                                  ASCII  x'DD'
   371            05  DFHSTRF                   PIC X VALUE 'h'.
   372	     *	  DFHQUIT is a CA-Realia CICS Extension
   373	     *	  It is set by using <Ctrl>+C or <Ctrl>+<Break> Keys
   374            05  DFHQUIT                   PIC X VALUE '!'.
   375		  05  DFHNULL			PIC X VALUE LOW-VALUE.
   377		  COPY DFHBMSCA.
   379	      01  DFHBMSCA.
   380	     *
   381	     * CA-Realia CICS 6.0 Computer Associates International, Inc.
   382	     *
   383	     * Revision Information
   384	     * ^{File:dfhbmsca.cob}
   385	     * ^{Timestamp:Tue Oct 08 15:34:54 1996}
   386	     * ^{Revision:2.0}
   387	     *
   388	     *	Note:This FILE is provided with most values as quoted literals
   389	     *	     so that the file can be used for both ASCII and EBCDIC
   390	     *	     programs
   391	     *
   392	     *	     The only exceptions are some 3270 Data Stream Orders
   393	     *	     They use different Hexadecimal values for ASCII and
   394	     *	     EBCDIC and they cannot be expressed as quoted literals
   395	     *	     as the values are <Line Feed>, <Tab>, <End of File> etc.
   396	     *	     characters in ASCII
   397	     *
   398	     *	     They have their values set up to default to the EBCDIC
   399	     *	     values.
   400	     *
   401	     *	     3270 orders are only needed for EXEC CICS SEND and RECEIVE
   402	     *	     and SEND TEXT with imbedded format orders.
   403	     *	     If you use these values in ASCII programs the values
   404	     *	     must be changed.
   405	     *
   406	     *	     An alternative is to use REPLACING to change the values.
   407	     *
   408	     *	  i.e. COPY DFHBMSCA replacing
   409	     *			    ==005== BY ==009==	*> DFHPT
   410	     *			    ==021== BY ==010==	*> DFHNL
   411	     *			    ==040== BY ==021==	*> DFHSA
   412	     *			    ==041== BY ==031==	*> DFHSFE
   413	     *			    ==044== BY ==023==	*> DFHMF
   414	     *			    ==060== BY ==020==	*> DFHRA
   415	     *			    ==063== BY ==026==. *> DFHSUB
   416	     *
   417	     ******************************************************************
   418	     *BMS and Terminal Control - Order & Attributes constants	      *
   419	     ******************************************************************
   420	     *
   421	     *	  Field Attributes
   422	     *
   423            05  DFHBMASB                          PIC X VALUE '8'.
   424            05  DFHBMASF                          PIC X VALUE '1'.
   425            05  DFHBMASK                          PIC X VALUE '0'.
   426            05  DFHBMBRY                          PIC X VALUE 'H'.
   427            05  DFHBMDAR                          PIC X VALUE '<'.
   428            05  DFHBMFSE                          PIC X VALUE 'A'.   429            05  DFHBMPRF                          PIC X VALUE '/'.
   430            05  DFHBMPRO                          PIC X VALUE '-'.
   431            05  DFHBMUNN                          PIC X VALUE '&'.
   432            05  DFHBMUNP                          PIC X VALUE ' '.
   433            05  DFHUNNUM                          PIC X VALUE 'J'.
   434	     *
   435	     *	  partially supported
   436	     *
   437            05  DFHUNNOD                          PIC X VALUE '('.
   438            05  DFHUNIMD                          PIC X VALUE 'I'.
   439            05  DFHUNINT                          PIC X VALUE 'R'.
   440            05  DFHUNNON                          PIC X VALUE '('.
   441            05  DFHPROTI                          PIC X VALUE 'Y'.
   442            05  DFHPROTN                          PIC X VALUE '%'.
   443	     *
   444	     *	  These values are additions to mainframe constants
   445	     *
   446            05  DFHBMS-ASK-DARK                   PIC X VALUE '@'.
   447            05  DFHBMS-ASK-BRY-FSET               PIC X VALUE '9'.
   448            05  DFHBMS-ASK-DAR-FSET               PIC X VALUE ''''.
   449	     *						      VALUE APOST
   450            05  DFHBMS-PRO-BRY-FSET               PIC X VALUE 'Z'.
   451            05  DFHBMS-PRO-DAR-FSET               PIC X VALUE '_'.
   452            05  DFHBMS-NUM-BRY                    PIC X VALUE 'Q'.
   453            05  DFHBMS-NUM-DAR                    PIC X VALUE '*'.
   454            05  DFHBMS-NUM-DAR-FSET               PIC X VALUE ')'.
   455	     *
   456	     *	  Field Flag values
   457		  05  DFHBMEOF-VAL VALUE 128		PIC S9(4) COMP-4.
   458		  05  FILLER REDEFINES DFHBMEOF-VAL.
   459		      10  FILLER			PIC X.
   460		      10  DFHBMEOF			PIC X.
   461       *                                          x'80'.
   462		  05  DFHBMCUR-VAL VALUE 002		PIC S9(4) COMP-4.
   463		  05  FILLER REDEFINES DFHBMCUR-VAL.
   464		      10  FILLER			PIC X.
   465		      10  DFHBMCUR			PIC X.
   466       *                                          x'02'.
   467		  05  DFHBMMEC-VAL VALUE 130		PIC S9(4) COMP-4.
   468		  05  FILLER REDEFINES DFHBMMEC-VAL.
   469		      10  FILLER			PIC X.
   470		      10  DFHBMMEC			PIC X.
   471       *                                          x'82'.
   472       *                                          x'02'.
   473		  05  DFHBMFLG-VAL  VALUE 0		PIC S9(4) COMP-4.
   474		      88  DFHERASE			VALUES 128 130.
   475       *                                          x'80' X'82'
   476		      88  DFHCURSR			VALUES 002 130.
   477       *                                          x'02' X'82'
   478		  05  FILLER REDEFINES DFHBMFLG-VAL.
   479		      10  FILLER			PIC X.
   480		      10  DFHBMFLG			PIC X.
   481
   482		  05  DFHBMDUP-VAL VALUE 028		PIC S9(4) COMP-4.
   483		  05  FILLER REDEFINES DFHBMDUP-VAL.
   484		      10  FILLER			PIC X.
   485		      10  DFHBMDUP			PIC X.
   486       *                                              x'1C'
   487	     *
   488	     ******************************************************************   489	     *	  supported 327X Extended Attributes
   490	     *
   491	     *	  Extended COLOR Attributes
   492	     *
   493            05  DFHDFCOL                          PIC X VALUE '0'.
   494            05  DFHBLUE                           PIC X VALUE '1'.
   495            05  DFHRED                            PIC X VALUE '2'.
   496            05  DFHPINK                           PIC X VALUE '3'.
   497            05  DFHGREEN                          PIC X VALUE '4'.
   498            05  DFHTURQ                           PIC X VALUE '5'.
   499            05  DFHYELLO                          PIC X VALUE '6'.
   500            05  DFHNEUTR                          PIC X VALUE '7'.
   501	     *
   502	     *	  Extended HILIGHT Attributes
   503	     *
   504            05  DFHDFHI                           PIC X VALUE '0'.
   505            05  DFHBLINK                          PIC X VALUE '1'.
   506            05  DFHREVRS                          PIC X VALUE '2'.
   507            05  DFHUNDLN                          PIC X VALUE '4'.
   508	     *
   509	     ******************************************************************
   510	     *	  supported 327X Data Stream Orders
   511	     *
   512		  05  DFHSBA-VAL VALUE 017		 PIC S9(4) COMP-4.
   513		  05  FILLER REDEFINES DFHSBA-VAL.
   514		      10  FILLER			PIC X.
   515		      10  DFHSBA			PIC X.
   516       *                                              x'11'
   517		  05  DFHEUA-VAL VALUE 018		PIC S9(4) COMP-4.
   518		  05  FILLER REDEFINES DFHEUA-VAL.
   519		      10  FILLER			PIC X.
   520		      10  DFHEUA			PIC X.
   521       *                                              x'12'
   522		  05  DFHIC-VAL VALUE 019		PIC S9(4) COMP-4.
   523		  05  FILLER REDEFINES DFHIC-VAL.
   524		      10  FILLER			PIC X.
   525		      10  DFHIC 			PIC X.
   526       *                                              X'13'.
   527		  05  DFHSF-VAL VALUE 029		PIC S9(4) COMP-4.
   528		  05  FILLER REDEFINES DFHSF-VAL.
   529		      10  FILLER			PIC X.
   530		      10  DFHSF 			PIC X.
   531       *                                              X'1D'.
   532		  05  DFHPT-VAL VALUE 005		PIC S9(4) COMP-4.
   533		      88 DFHPT-VAL-EBCDIC		VALUE 5.
   534		      88 DFHPT-VAL-ASCII		VALUE 9.
   535		  05  FILLER REDEFINES DFHPT-VAL.
   536		      10  FILLER			PIC X.
   537		      10  DFHPT 			PIC X.
   538       *                                              EBCDIC X'05'.
   539       *                                              ASCII  X'09'.
   540		  05  DFHRA-VAL VALUE 060		PIC S9(4) COMP-4.
   541		      88 DFHRA-VAL-EBCDIC		VALUE 60.
   542		      88 DFHRA-VAL-ASCII		VALUE 20.
   543		  05  FILLER REDEFINES DFHRA-VAL.
   544		      10  FILLER			PIC X.
   545		      10  DFHRA 			PIC X.
   546       *                                              EBCDIC x'3C'
   547       *                                              ASCII  x'14'
   548		  05  DFHSFE-VAL VALUE 041		PIC S9(4) COMP-4.   549		      88 DFHSFE-VAL-EBCDIC		VALUE 41.
   550		      88 DFHSFE-VAL-ASCII		VALUE 31.
   551		  05  FILLER REDEFINES DFHSFE-VAL.
   552		      10  FILLER			PIC X.
   553		      10  DFHSFE			PIC X.
   554       *                                              EBCDIC x'29'
   555       *                                              ASCII  x'1F'
   556		  05  DFHMF-VAL VALUE 044		PIC S9(4) COMP-4.
   557		      88 DFHMF-VAL-EBCDIC		VALUE 44.
   558		      88 DFHMF-VAL-ASCII		VALUE 23.
   559		  05  FILLER REDEFINES DFHMF-VAL.
   560		      10  FILLER			PIC X.
   561		      10  DFHMF 			PIC X.
   562       *                                              EBCDIC x'2C'
   563       *                                              ASCII  x'17'
   564	     *
   565	     ******************************************************************
   566	     *	  unsupported 327X Data Stream order codes
   567	     *
   568		  05  DFHSA-VAL VALUE 040		PIC S9(4) COMP-4.
   569		      88 DFHSA-VAL-EBCDIC		VALUE 40.
   570		      88 DFHSA-VAL-ASCII		VALUE 21.
   571		  05  FILLER REDEFINES DFHSA-VAL.
   572		      10  FILLER			PIC X.
   573		      10  DFHSA 			PIC X.
   574       *                                              EBCDIC x'28'
   575       *                                              ASCII  x'15'
   576		  05  DFHGE-VAL VALUE 008		PIC S9(4) COMP-4.
   577		  05  FILLER REDEFINES DFHGE-VAL.
   578		      10  FILLER			PIC X.
   579		      10  DFHGE 			PIC X.
   580       *                                              X'08'.
   581	     *
   582	     ******************************************************************
   583	     *	  SFE and MF supported attribute types
   584	     *
   585            05  DFHCOLOR                          PIC X VALUE 'ƒ'.
   586       *                                              EBCDIC x'42'
   587       *                                              ASCII  x'83'
   588            05  DFHHLT                            PIC X VALUE 'Ö'.
   589       *                                              EBCDIC x'41'
   590       *                                              ASCII  x'D6'
   591            05  DFH3270                           PIC X VALUE '{'.
   592	     *
   593	     *	  supported for SEND TEXT command and printer terminal
   594	     *
   595		  05  DFHBMPNL-VAL VALUE 021		PIC S9(4) COMP-4.
   596		      88 DFHBMPNL-VAL-EBCDIC		VALUE 21.
   597		      88 DFHBMPNL-VAL-ASCII		VALUE 10.
   598		  05  FILLER REDEFINES DFHBMPNL-VAL.
   599		      10  FILLER			PIC X.
   600		      10  DFHBMPNL			PIC X.
   601       *                                              EBCDIC X'15'.
   602       *                                              ASCII  X'0A'.
   603	     *
   604	     ******************************************************************
   605	     *	  Printer terminal data stream only
   606	     *
   607		  05  DFHBMPFF-VAL VALUE 012		PIC S9(4) COMP-4.
   608		  05  FILLER REDEFINES DFHBMPFF-VAL.   609		      10  FILLER			PIC X.
   610		      10  DFHBMPFF			PIC X.
   611       *                                              X'0C'.
   612		  05  DFHBMPCR-VAL VALUE 013		PIC S9(4) COMP-4.
   613		  05  FILLER REDEFINES DFHBMPCR-VAL.
   614		      10  FILLER			PIC X.
   615		      10  DFHBMPCR			PIC X.
   616       *                                              X'0D'.
   617		  05  DFHBMPEM-VAL VALUE 025		PIC S9(4) COMP-4.
   618		  05  FILLER REDEFINES DFHBMPEM-VAL.
   619		      10  FILLER			PIC X.
   620		      10  DFHBMPEM			PIC X.
   621       *                                              X'19'.
   622	     *
   623	     ******************************************************************
   624	     *	  unsupported Miscellaneous attributes and constants
   625	     *
   626		  05  DFHALL				PIC X VALUE LOW-VALUES.
   627            05  DFHBASE                           PIC X VALUE '0'.
   628		  05  DFHBMDET				PIC X VALUE LOW-VALUES.
   629		  05  DFHBMPSOSI-VAL VALUE 3599 	PIC S9(4) COMP-4.
   630		  05  FILLER REDEFINES DFHBMPSOSI-VAL.
   631		      10  DFHBMPSO			PIC X.
   632       *                                              X'0E'.
   633		      10  DFHBMPSI			PIC X.
   634       *                                              X'0F'.
   635		  05  DFHDFT VALUE HIGH-VALUES		PIC X.
   636            05  DFHERROR                          PIC X VALUE '¶'.
   637       *                                              EBCDIC X'1A'.
   638       *                                              ASCII  X'B6'.
   639            05  DFHFIL                            PIC X VALUE '4'.
   640            05  DFHMENT                           PIC X VALUE '2'.
   641            05  DFHMET                            PIC X VALUE '3'.
   642            05  DFHMFE                            PIC X VALUE '6'.
   643            05  DFHMFET                           PIC X VALUE '7'.
   644            05  DFHMFT                            PIC X VALUE '5'.
   645            05  DFHMT                             PIC X VALUE '1'.
   646            05  DFHOUTLN                          PIC X VALUE 'B'.
   647            05  DFHPS                             PIC X VALUE '„'.
   648       *                                              EBCDIC x'43'
   649       *                                              ASCII  x'84'
   650            05  DFHVAL                            PIC X VALUE 'A'.
   651	     *
   652		  05  DFHSUB-VAL   VALUE 063		PIC S9(4) COMP-4.
   653		      88 DFHSUB-VAL-EBCDIC		VALUE 63.
   654		      88 DFHSUB-VAL-ASCII		VALUE 26.
   655		  05  FILLER REDEFINES DFHSUB-VAL.
   656		      10  FILLER			PIC X.
   657		      10  DFHSUB			PIC X.
   658       *                                              EBCDIC X'3F'.
   659       *                                              ASCII  X'1A'.
   660	     *
   661		  05  DFHFM-VAL    VALUE 030		PIC S9(4) COMP-4.
   662		  05  FILLER REDEFINES DFHFM-VAL.
   663		      10  FILLER			PIC X.
   664		      10  DFHFM 			PIC X.
   665       *                                              EBCDIC X'1E'.
   666		  05  DFHEO VALUE HIGH-VALUE		PIC X.
   668
   669	     *----------------------------------------------------------------*   670	     *			       LINKAGE SECTION			      *
   671	     *----------------------------------------------------------------*
   672	      LINKAGE SECTION.
   674	      01  DFHEIBLK.						       R
   675		  05 EIBTIME  PIC S9(7) COMP-3. 			       R
   676		  05 EIBDATE  PIC S9(7) COMP-3. 			       R
   677		  05 EIBTRNID PIC X(4). 				       R
   678		  05 EIBTASKN PIC S9(7) COMP-3. 			       R
   679		  05 EIBTRMID PIC X(4). 				       R
   680		  05 DFHEIGDI PIC S9(4) COMP-4. 			       R
   681		  05 EIBCPOSN PIC S9(4) COMP-4. 			       R
   682		  05 EIBCALEN PIC S9(4) COMP-4. 			       R
   683		  05 EIBAID   PIC X.					       R
   684		  05 EIBFN    PIC X(2). 				       R
   685		  05 EIBRCODE PIC X(6). 				       R
   686		  05 EIBDS    PIC X(8). 				       R
   687		  05 EIBREQID PIC X(8). 				       R
   688		  05 EIBRSRCE PIC X(8). 				       R
   689		  05 EIBSYNC  PIC X.					       R
   690		  05 EIBFREE  PIC X.					       R
   691		  05 EIBRECV  PIC X.					       R
   692		  05 EIBSEND  PIC X.					       R
   693		  05 EIBATT   PIC X.					       R
   694		  05 EIBEOC   PIC X.					       R
   695		  05 EIBFMH   PIC X.					       R
   696		  05 EIBCOMPL PIC X.					       R
   697		  05 EIBSIG   PIC X.					       R
   698		  05 EIBCONF  PIC X.					       R
   699		  05 EIBERR   PIC X.					       R
   700		  05 EIBERRCD PIC X(4). 				       R
   701		  05 EIBSYNRB PIC X.					       R
   702		  05 EIBNODAT PIC X.					       R
   703		  05 EIBRESP  PIC S9(8) COMP-4. 			       R
   704		  05 EIBRESP2 PIC S9(8) COMP-4. 			       R
   705		  05 EIBRLDBK PIC X.					       R
   706		  05 EIBCARESERVED PIC X(32).				       R
   708	       01 DFHCOMMAREA.
   709		  05 DF-PGMID				PIC X(06).
   710		  05 DF-STATE				PIC X.
   711		  05 DF-TICKET-PASSED			PIC X(07).
   712		  05 DF-USERID.
   713		     10  DF-USERID7			PIC X(7).
   714		     10  FILLER 			PIC X(1).
   715		  05 DF-USR-TYPE.
   716		    15 DF-USR-REQUESTOR 		PIC X.
   717		    15 DF-USR-ADMIN			PIC X.
   718		    15 DF-USR-APPROVER			PIC X.
   719		    15 DF-USR-SERVICE			PIC X.
   720		  05 DF-SM012-STATE			PIC X.
   721		  05 DF-SM012-PGMID			PIC X(06).
   722		  05 DF-STF01-REC.
   723		     10 DF-STF01-ID			PIC X(07).
   724		     10 DF-FILLER			PIC X(03).
   725		     10 DF-STF01-TITLE			PIC X(25).
   726		     10 DF-FILLER			PIC X(01).
   727		     10 DF-STF01-STATUS 		PIC X(10).
   728		     10 DF-FILLER			PIC X(04).
   729		     10 DF-STF01-LAST-UPD		PIC X(10).
   730		     10 DF-FILLER4			PIC X(02).
   731		     10 DF-STF01-LAST-UPDBY		PIC X(8).   732		     10 DF-STF01-REQ			PIC X(8).
   733		  05 DF-PGMNAME 			PIC X(6).
   734		  05 DFHSTATE				PIC X(15).
   735		  05 DF-TRANS				PIC X(04).
   736		  05 DF-LUSER				PIC 9(03).
   737		  05 DF-FUSER				PIC X(07).
   738		  05 DF-PAGE				PIC 9(02).
   739		  05 DF-PAGE-END			PIC 9(01).
   740		  05 DF-ADDED-USER			PIC X(08).
   741		  05 DF-ADDED-USER			PIC X(08).
   742		  05 DF-TIX-DETL.
   743		     10 DF-TIX-KEY			PIC X(07).
   744		     10 DF-TIX-KEY-NUM REDEFINES DF-TIX-KEY PIC 9(06).
   745		     10 DF-TIX-REQUESTOR		PIC X(8).
   746		     10 DF-TIX-STATUS			PIC X(10).
   747		     10 DF-TIX-TITLE			PIC X(25).
   748		     10 DF-TIX-DESC			PIC X(100).
   749		     10 DF-TIX-LAST-UPD 		PIC X(20).
   750		     10 DF-TIX-LAST-UPDBY		PIC X(8).
   751		     10 DF-TIX-UPD-REMARKS		PIC X(50).
   752
   753	      PROCEDURE DIVISION					       R
   755		  USING DFHEIBLK DFHCOMMAREA.				       R
   780	      100-PROCESS.
   782		  EXEC CICS IGNORE CONDITION
   783			    ERROR
   784		  END-EXEC
   799
   800		  MOVE DFHCOMMAREA TO WS-COMMAREA
   801            IF WS-PGMID = 'SM000' OR WS-PGMID = 'SM001' OR
   802               WS-PGMID = 'SM012'
   803			  EVALUATE TRUE
   804			   WHEN WS-STATE = LOW-VALUES
   805				EVALUATE TRUE
   806				   WHEN WS-TICKET-PASSED = LOW-VALUES
   807				       MOVE 1 TO WS-STATE
   808				       MOVE WS-ENTER-TICKET TO ERRMSGO
   809				       MOVE -1 TO TKTNUML
   810				       PERFORM 200-NEW-MAP
   811				END-EVALUATE
   812			   WHEN WS-STATE = 1
   813				PERFORM 300-REC-MAP
   814				PERFORM 400-CHECK-AID
   815				PERFORM 500-MOVE-FILE-TO-COMM
   816				PERFORM 200-NEW-MAP
   817			   WHEN WS-STATE = 2
   818				PERFORM 300-REC-MAP
   819				PERFORM 400-CHECK-AID
   820				PERFORM 200-NEW-MAP
   821			   WHEN WS-STATE = 3
   822				PERFORM 300-REC-MAP
   823				PERFORM 400-CHECK-AID
   824				PERFORM 200-NEW-MAP
   825			  END-EVALUATE
   826		   ELSE
   827		       MOVE SPACES TO ERRMSGO
   828		       MOVE LENGTH OF WS-INVALID-ACCESS TO WS-LENGTH
   830		       EXEC CICS SEND TEXT
   831			    FROM (WS-INVALID-ACCESS)
   832			    LENGTH (WS-LENGTH)   833			    ERASE
   834			END-EXEC
   865		       EXEC CICS RETURN
   866		       END-EXEC
   879		   END-IF.
   880
   881	      100-EXIT.
   882		  EXIT.
   883
   884	      110-DATE-AND-TIME.
   885
   886		  MOVE EIBDATE TO WS-DATE.
   887		  MOVE WS-DATE-X TO DATEO.
   889		  EXEC CICS ASKTIME
   890			  ABSTIME      (WS-TIME)
   891			  END-EXEC
   910			  EXEC CICS FORMATTIME
   911			  ABSTIME      (WS-TIME)
   912                    DATESEP      ('/')
   913			  MMDDYYYY (DATEO)
   914		      TIME     (TIMEO)
   915                TIMESEP  (':')
   916		  END-EXEC.
   957	      110-EXIT.
   958		  EXIT.
   959
   960	      200-NEW-MAP.
   961
   962		  PERFORM 110-DATE-AND-TIME
   964		  EXEC CICS SEND
   965                  MAP('SM006M')
   966                  MAPSET('SM06S')
   967			FROM(SM006MO)
   968			CURSOR
   969			LENGTH(WS-LENGTH)
   970			ERASE
   971		  END-EXEC
  1017		  EXEC CICS RETURN
  1018                 TRANSID('SM06')
  1019		       COMMAREA(WS-COMMAREA)
  1020		  END-EXEC.
  1045
  1046	      200-EXIT.
  1047		  EXIT.
  1048
  1049	      300-REC-MAP.
  1051		  EXEC CICS RECEIVE
  1052                 MAP('SM006M')
  1053                 MAPSET('SM06S')
  1054		       INTO (SM006MI)
  1055		  END-EXEC.
  1089
  1090	      300-EXIT.
  1091		  EXIT.
  1092
  1093	      400-CHECK-AID.
  1094		  EVALUATE EIBAID
  1095		      WHEN DFHENTER
  1096			  EVALUATE TRUE
  1097			      WHEN WS-STATE = 1  1098			      MOVE 2 TO WS-STATE
  1099			      MOVE -1 TO TKTNUML
  1100			   IF TKTNUMI NOT = LOW-VALUES
  1101			      MOVE TKTNUMI TO WS-TICKET-PASSED
  1102			   ELSE
  1103			       MOVE WS-TICKET-PASSED TO TKTNUMI
  1104			   END-IF
  1105			      PERFORM 600-TICKET-VALID
  1106                        IF WS-FOUND = 'Y'
  1107				  PERFORM 700-MOVE-DATA-TO-SCREEN
  1108				  MOVE WS-PRESS-F2 TO ERRMSGO
  1109			      ELSE
  1110				  PERFORM 610-MOVE-LOW-VAL
  1111				  MOVE 1 TO WS-STATE
  1112			      END-IF
  1113		      WHEN WS-STATE = 2
  1114			      PERFORM 410-REDISPLAY-INVALID-PFKEY
  1115			      MOVE WS-PRESS-F2 TO ERRMSGO
  1116			      MOVE -1 TO TKTNUML
  1117			 CONTINUE
  1118		      WHEN WS-STATE = 3
  1119			  MOVE 1 TO WS-STATE
  1120			  PERFORM 610-MOVE-LOW-VAL
  1121			  MOVE -1 TO TKTNUML
  1122			  MOVE WS-ENTER-TICKET TO ERRMSGO
  1123		      END-EVALUATE
  1124		   WHEN DFHPF2
  1125		       EVALUATE TRUE
  1126			   WHEN WS-STATE = LOW-VALUES
  1127			       CONTINUE
  1128			   WHEN WS-STATE = 1
  1129			       MOVE -1 TO TKTNUML
  1130			       MOVE WS-ENTER-TICKET TO ERRMSGO
  1131			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1132			       CONTINUE
  1133			   WHEN WS-STATE = 2
  1134			       PERFORM 600-TICKET-VALID
  1135			       MOVE WS-TICKET-CANCELED TO ERRMSGO
  1136			       PERFORM 110-DATE-AND-TIME
  1137			       MOVE DATEO TO UPDTO(1:10)
  1138			       MOVE TIMEO TO UPDTO(12:9)
  1139			       MOVE WS-TIX-KEY TO TKTNUMI
  1140			       MOVE WS-TIX-REQUESTOR TO REQBYO
  1141			       MOVE WS-TIX-TITLE TO TKTLEO
  1142			       MOVE TICKET-DESC (1:50) TO TKDES1O
  1143			       MOVE TICKET-DESC (51:50) TO TKDES2O
  1144                         MOVE 'CANCELED' TO STATO
  1145			       MOVE USERID TO UPDTBYO
  1146                         MOVE 'TICKET CANCELED' TO UPDREM1O
  1147			       MOVE 3 TO WS-STATE
  1148			       PERFORM 500-MOVE-FILE-TO-COMM
  1149			       PERFORM 710-UPDATE-TICKET
  1150			       PERFORM 800-READ-LOG-REC
  1151			       MOVE -1 TO TKTNUML
  1152			   WHEN WS-STATE = 3
  1153			       MOVE -1 TO TKTNUML
  1154			       MOVE WS-TICKET-CANCELED TO ERRMSGO
  1155			       PERFORM 110-DATE-AND-TIME
  1156			       MOVE DATEO TO UPDTO (1:10)
  1157			       MOVE TIMEO TO UPDTO (12:9)  1158			       MOVE WS-TIX-KEY TO TKTNUMI
  1159			       MOVE WS-TIX-REQUESTOR TO REQBYO
  1160			       MOVE WS-TIX-TITLE TO TKTLEO
  1161			       MOVE TICKET-DESC (1:50) TO TKDES1O
  1162			       MOVE TICKET-DESC (51:50) TO TKDES2O
  1163                         MOVE 'CANCELED' TO STATO
  1164			       MOVE USERID TO UPDTBYO
  1165                         MOVE 'TICKET CANCELED' TO UPDREM1O
  1166		       END-EVALUATE
  1167
  1168		    WHEN DFHPF3
  1169		       MOVE LOW-VALUES TO WS-STATE
  1170		       MOVE LOW-VALUES TO WS-TICKET-PASSED
  1171		       EVALUATE WS-PGMID
  1172                  WHEN 'SM000'
  1173                     MOVE 'SM006' TO WS-PGMID
  1175				   EXEC CICS XCTL
  1176                                      PROGRAM('SM000')
  1177				COMMAREA(WS-COMMAREA)
  1178			   END-EXEC
  1202                  WHEN 'SM001'
  1203                     MOVE 'SM006' TO WS-PGMID
  1205			   EXEC CICS XCTL
  1206                                       PROGRAM('SM001')
  1207				  COMMAREA(WS-COMMAREA)
  1208			   END-EXEC
  1232                  WHEN 'SM012'
  1233                     MOVE 'SM006' TO WS-PGMID
  1235			   EXEC CICS XCTL
  1236                                       PROGRAM('SM012')
  1237				  COMMAREA(WS-COMMAREA)
  1238			   END-EXEC
  1262		       END-EVALUATE
  1263
  1264		   WHEN DFHPF5
  1265		       EVALUATE TRUE
  1266			   WHEN WS-STATE = LOW-VALUES
  1267			       MOVE -1 TO TKTNUML
  1268			       MOVE WS-ENTER-TICKET TO ERRMSGO
  1269			       CONTINUE
  1270			   WHEN WS-STATE = 1
  1271			       MOVE -1 TO TKTNUML
  1272			       MOVE WS-ENTER-TICKET TO ERRMSGO
  1273			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1274			       CONTINUE
  1275			   WHEN WS-STATE = 2
  1276			       MOVE 1 TO WS-STATE
  1277			       MOVE -1 TO TKTNUML
  1278			       PERFORM 610-MOVE-LOW-VAL
  1279			       MOVE WS-PRESS-F5 TO ERRMSGO
  1280			       CONTINUE
  1281			   WHEN WS-STATE = 3
  1282			       MOVE -1 TO TKTNUML
  1283			       MOVE WS-TICKET-CANCELED TO ERRMSGO
  1284			       PERFORM 110-DATE-AND-TIME
  1285			       MOVE DATEO TO UPDTO (1:10)
  1286			       MOVE TIMEO TO UPDTO (12:9)
  1287			       MOVE WS-TIX-KEY TO TKTNUMI
  1288			       MOVE WS-TIX-REQUESTOR TO REQBYO
  1289			       MOVE WS-TIX-TITLE TO TKTLEO  1290			       MOVE TICKET-DESC (1:50) TO TKDES1O
  1291			       MOVE TICKET-DESC (51:50) TO TKDES2O
  1292                         MOVE 'CANCELED' TO STATO
  1293			       MOVE USERID TO UPDTBYO
  1294                         MOVE 'TICKET CANCELED' TO UPDREM1O
  1295		       END-EVALUATE
  1296		    WHEN DFHPF12
  1297                   MOVE 'SM006' TO WS-SM012-PGMID
  1298	     *		 MOVE LOW-VALUES TO WS-STATE
  1299			 MOVE LOW-VALUES TO WS-SM012-STATE
  1301			 EXEC CICS XCTL
  1302                        PROGRAM('SM012')
  1303			      COMMAREA(WS-COMMAREA)
  1304			 END-EXEC
  1328		   WHEN DFHCLEAR
  1329		       EVALUATE TRUE
  1330			   WHEN WS-STATE = LOW-VALUES
  1331			       MOVE -1 TO TKTNUML
  1332			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1333			       PERFORM 200-NEW-MAP
  1334			   WHEN WS-STATE = 1
  1335			       MOVE -1 TO TKTNUML
  1336			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1337			       PERFORM 200-NEW-MAP
  1338			   WHEN WS-STATE = 2
  1339			       PERFORM 410-REDISPLAY-INVALID-PFKEY
  1340			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1341			       MOVE -1 TO TKTNUML
  1342			       PERFORM 200-NEW-MAP
  1343			   WHEN WS-STATE = 3
  1344			       PERFORM 410-REDISPLAY-INVALID-PFKEY
  1345			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1346			       MOVE -1 TO TKTNUML
  1347			       PERFORM 200-NEW-MAP
  1348		       END-EVALUATE
  1349		   WHEN OTHER
  1350			       PERFORM 410-REDISPLAY-INVALID-PFKEY
  1351			       MOVE WS-INVALID-PFKEY TO ERRMSGO
  1352			       MOVE -1 TO TKTNUML
  1353			       PERFORM 200-NEW-MAP
  1354
  1355		  END-EVALUATE.
  1356
  1357	      400-EXIT.
  1358		  EXIT.
  1359
  1360	      410-REDISPLAY-INVALID-PFKEY.
  1361
  1362		  MOVE WS-TIX-KEY TO TKTNUMI
  1363		  MOVE WS-TIX-REQUESTOR TO REQBYO
  1364		  MOVE WS-TIX-TITLE TO TKTLEO
  1365		  EVALUATE WS-STATE
  1366		      WHEN 2
  1367			  MOVE WS-TIX-DESC(1:50) TO TKDES1O
  1368			  MOVE WS-TIX-DESC(51:50) TO TKDES2O
  1369			  MOVE WS-TIX-UPD-REMARKS(1:25) TO UPDREM1O
  1370			  MOVE WS-TIX-UPD-REMARKS(26:25) TO UPDREM2O
  1371		      WHEN 3
  1372			  MOVE TICKET-DESC(1:50) TO TKDES1O
  1373			  MOVE TICKET-DESC(51:50) TO TKDES2O  1374			  MOVE TICKET-UPDT-REMARKS(1:25) TO UPDREM1O
  1375			  MOVE TICKET-UPDT-REMARKS(26:25) TO UPDREM2O
  1376		   END-EVALUATE
  1377		  MOVE WS-TIX-STATUS TO STATO
  1378		  MOVE WS-TIX-LAST-UPDBY TO UPDTBYO
  1379		  MOVE WS-TIX-LAST-UPD TO UPDTO.
  1380
  1381	      410-EXIT.
  1382		  EXIT.
  1383
  1384	      500-MOVE-FILE-TO-COMM.
  1385		  IF TKTNUMI = LOW-VALUES
  1386		     MOVE WS-TICKET-PASSED TO WS-TIX-KEY
  1387		  ELSE
  1388		  MOVE TKTNUMI TO WS-TIX-KEY
  1389		  END-IF
  1390		  MOVE REQBYO TO WS-TIX-REQUESTOR
  1391		  MOVE TKTLEO TO WS-TIX-TITLE
  1392		  MOVE TKDES1O TO WS-TIX-DESC(1:50)
  1393		  MOVE TKDES2O TO WS-TIX-DESC(51:50)
  1394		  MOVE STATO TO WS-TIX-STATUS
  1395		  MOVE UPDTBYO TO WS-TIX-LAST-UPDBY
  1396		  MOVE UPDREM1O TO WS-TIX-UPD-REMARKS(1:25)
  1397		  MOVE UPDREM2O TO WS-TIX-UPD-REMARKS(26:25)
  1398		  MOVE UPDTO TO WS-TIX-LAST-UPD.
  1399
  1400	      500-EXIT.
  1401		  EXIT.
  1402
  1403	      600-TICKET-VALID.
  1404
  1406		  EXEC CICS STARTBR
  1407                 FILE('STF001C')
  1408		       RIDFLD (WS-TICKET-PASSED)
  1409		       GTEQ
  1410		   END-EXEC
  1437		   IF EIBRESP = +0
  1439		       EXEC CICS
  1440                      READ FILE('STF001C')
  1441			    INTO (TICKET-REC)
  1442			    RIDFLD(WS-TICKET-PASSED)
  1443			    EQUAL
  1444			    UPDATE
  1445		       END-EXEC
  1480             MOVE 'Y' TO WS-FOUND
  1481                 IF TICKET-STATUS = 'ONGOING' OR 'CREATED' OR 'CLOSED'
  1482                                    OR 'COMPLETED' OR 'APPROVED'
  1483                 MOVE 'Y' TO WS-FOUND
  1484		   ELSE
  1485		       MOVE -1 TO TKTNUML
  1486                 MOVE 'N' TO WS-FOUND
  1487		       MOVE WS-INVALID-STATUS TO ERRMSGO
  1488		   END-IF
  1489		   ELSE
  1490		       MOVE -1 TO TKTNUML
  1491                 MOVE 'N' TO WS-FOUND
  1492		       MOVE WS-NOT-EXIST TO ERRMSGO
  1493		   END-IF.
  1494
  1495	      600-EXIT.  1496		  EXIT.
  1497
  1498	      610-MOVE-LOW-VAL.
  1499
  1500		  MOVE LOW-VALUES TO REQBYO
  1501		  MOVE LOW-VALUES TO TKTLEO
  1502		  MOVE LOW-VALUES TO TKDES1O
  1503		  MOVE LOW-VALUES TO TKDES2O
  1504		  MOVE LOW-VALUES TO STATO
  1505		  MOVE LOW-VALUES TO UPDTBYO
  1506		  MOVE LOW-VALUES TO UPDREM1O
  1507		  MOVE LOW-VALUES TO UPDREM2O
  1508		  MOVE LOW-VALUES TO UPDTO.
  1509
  1510	      610-EXIT.
  1511		  EXIT.
  1512
  1513	      700-MOVE-DATA-TO-SCREEN.
  1514
  1515		  MOVE TICKET-REQ-BY TO REQBYO
  1516		  MOVE TICKET-TITLE  TO TKTLEO
  1517		  MOVE TICKET-DESC(1:50) TO TKDES1O
  1518		  MOVE TICKET-DESC(51:50) TO TKDES2O
  1519		  MOVE TICKET-STATUS TO STATO
  1520		  MOVE TICKET-UPDT-BY TO UPDTBYO
  1521		  MOVE TICKET-UPDT-REMARKS(1:25) TO UPDREM1O
  1522		  MOVE TICKET-UPDT-REMARKS(26:25) TO UPDREM2O
  1523		  MOVE TICKET-UPDT-TIME TO UPDTO.
  1524
  1525
  1526	      700-EXIT.
  1527		  EXIT.
  1528
  1529	      710-UPDATE-TICKET.
  1530
  1531	     *	  MOVE WS-TICKET-PASSED TO WS-TICKET-KEY
  1532		  MOVE REQBYO TO TICKET-REQ-BY
  1533		  MOVE TKTLEO TO TICKET-TITLE
  1534		  MOVE TKDES1O TO TICKET-DESC(1:50)
  1535		  MOVE TKDES2O TO TICKET-DESC(51:50)
  1536		  MOVE STATO TO TICKET-STATUS
  1537		  MOVE UPDTBYO TO TICKET-UPDT-BY
  1538		  MOVE UPDREM1O TO TICKET-UPDT-REMARKS(1:25)
  1539		  MOVE UPDREM2O TO TICKET-UPDT-REMARKS(26:25)
  1540		  MOVE UPDTO TO TICKET-UPDT-TIME
  1542		  EXEC CICS
  1543                 REWRITE FILE ('STF001C')
  1544		       FROM (TICKET-REC)
  1545		       RESP(WS-RETNCODE)
  1546		       RESP2(WS-RETNCODE2)
  1547		  END-EXEC.
  1579
  1580
  1581	      710-EXIT.
  1582		  EXIT.
  1583
  1584	      800-READ-LOG-REC.
  1585
  1587		  EXEC CICS READ
  1588                FILE('STF002E')  1589		      INTO(WS-TICKET-LOGS)
  1590		      RIDFLD(WS-KEY-LOG)
  1591		      GTEQ
  1592		  END-EXEC
  1624		  MOVE WS-TICKET-PASSED TO WS-LOG-TICKET-ID
  1625		  ADD 1 TO WS-LOG-SEQ-NUM
  1626		  MOVE USERID TO WS-LOG-UPDT-BY
  1627		  MOVE DATEO TO WS-LOG-UPDT-TIME(1:10)
  1628		  MOVE TIMEO TO WS-LOG-UPDT-TIME(12:9)
  1629		  MOVE UPDREM1O TO WS-LOG-UPDT-REMARKS(1:25)
  1630		  MOVE UPDREM2O TO WS-LOG-UPDT-REMARKS(26:25)
  1631		  PERFORM 810-CREATE-LOG-REC.
  1632
  1633	      800-EXIT.
  1634		  EXIT.
  1635
  1636	      810-CREATE-LOG-REC.
  1638		  EXEC CICS
  1639                 WRITE FILE('STF002E')
  1640		       FROM (WS-TICKET-LOGS)
  1641		       RIDFLD (WS-KEY-LOG)
  1642		       RESP(WS-RETNCODE)
  1643		  END-EXEC.
  1679	      810-EXIT.
  1680		  EXIT.CA-Realia COBOL Version 6.0.45	 D:\work\CAWB30-HO\SM006.cic	       PAGE   20



			Realia COBOL Compiler Version Information

			      Pass 1	 Version 6.072
			      Pass 1a	 Version 6.015
			      Pass 2	 Version 6.068
			      Pass 2a	 Version 6.020
			      Pass 3	 Version 6.094
			      Pass 4	 Version 6.007
			      Pass 5	 Version 6.022


			Compilation Directives in Effect

COMP-4		  DCHK		    OPT 	      NOCALL
NOSUBCHK	  STRCHK	    NOTRUNC	      NOSMALLCOMP
NODCALL 	  NODIVZERO	    NOEPDCALL	      APOST
EBCDIC		  STATABORT	    NOMOVELINK	      NOBLL4K
ARGCHK		  UPLOW 	    NOVERARG	      MDY
LP:   60	  PP		    FCREATE	      NOIEEE
NOLILIAN	  CURRENCY-SIGN=$   WRITEAFTER	      SOSI
NOCOPY68	  NOFLAG-COM	    NOFLAG-SEG	      NOFLAG-FIPS
DEBUGXREF	  DIALECT-VS2

			Error level limit: W

			Source lines compiled:	    1691
			Compilation time (mm:ss.ss):  0:00.05
			Compilation speed (lines/minute): 29200

			Compilation date (yy/mm/dd): 23/12/06
			     Time of day (hh:mm:ss): 20:42:57